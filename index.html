<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ritual Remix - ä¹ ä¿—é‡æ„</title>
    <style>
        /* --- 1. åŸºç¡€å˜é‡ --- */
        :root {
            --red-color: #8B0000;
            --blue-color: #0056b3;
            --green-color: #2E7D32;
            --bg-color: #f4f4f4;
            --modal-blue: #0056b3;
            --modal-text: #4a5568;
            --btn-disabled: #cccccc;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100dvh; 
            padding-bottom: 150px; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- 2. åŠ¨ç”»æ•ˆæœ --- */
        /* å±å¹•éœ‡åŠ¨ */
        .shake-screen {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* ã€æ ¸å¿ƒä¿®å¤ã€‘å¡ç‰Œæ‹’ç»éœ‡åŠ¨ - ä½¿ç”¨ CSS åŠ¨ç”»ä»£æ›¿ JS ä¿®æ”¹æ ·å¼ */
        @keyframes cardDeny {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        .card.denying {
            animation: cardDeny 0.3s ease-in-out;
        }

        h1 { margin-top: 20px; font-size: 1.5rem; color: #333; text-align: center; }

        p.instruction {
            font-size: 0.9rem; color: #666; text-align: center;
            margin-bottom: 15px; padding: 0 20px; max-width: 600px; line-height: 1.5;
        }

        /* --- 3. ç½‘æ ¼å¸ƒå±€ --- */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 600px; width: 95%;
            perspective: 1000px;
            margin-bottom: 20px;
            position: relative; 
            z-index: 10;
        }
        @media (min-width: 600px) {
            .game-grid { grid-template-columns: repeat(4, 1fr); gap: 15px; }
        }

        /* --- 4. å¡ç‰‡æ ·å¼ --- */
        .card {
            background-color: transparent; height: 160px;
            cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s;
            z-index: 11;
            touch-action: manipulation; 
            -webkit-user-select: none;
            user-select: none;
        }

        .card.flip { transform: rotateY(180deg); }

        .front, .back {
            width: 100%; height: 100%; position: absolute;
            border-radius: 10px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            padding: 8px; box-sizing: border-box; backface-visibility: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-size: 0.9rem; line-height: 1.3;
            pointer-events: none; 
        }

        /* æ­£é¢æ ·å¼ */
        .front {
            background-color: #333; color: white; font-weight: bold; border: 2px solid white;
        }
        .card[data-type="ritual"] .front {
            background: repeating-linear-gradient(45deg, var(--red-color), var(--red-color) 10px, #600000 10px, #600000 20px);
        }
        .card[data-type="rewrite"] .front {
            background: repeating-linear-gradient(45deg, var(--blue-color), var(--blue-color) 10px, #003d80 10px, #003d80 20px);
        }

        /* èƒŒé¢æ ·å¼ */
        .back {
            background-color: white; transform: rotateY(180deg);
            border: 2px solid #ddd; padding-bottom: 25px;
        }
        .card[data-type="ritual"] .back { 
            border-top: 8px solid var(--red-color); 
            color: var(--red-color); 
        }
        .card[data-type="rewrite"] .back { 
            border-top: 8px solid var(--blue-color); 
            color: var(--blue-color); 
        }

        /* é€‰ä¸­çŠ¶æ€ */
        .card.flip .back {
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
        }

        /* åŒ¹é…æˆåŠŸ */
        .card.matched .back {
            border-color: var(--green-color); 
            box-shadow: 0 0 10px rgba(46, 125, 50, 0.3);
            pointer-events: auto;
        }
        .card.matched .back::after {
            content: "â„¹ï¸ ç‚¹å‡»å›é¡¾"; position: absolute; bottom: 8px; left: 50%;
            transform: translateX(-50%); font-size: 0.65rem;
            background-color: var(--green-color); color: white;
            padding: 3px 8px; border-radius: 10px; white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease-in-out;
        }

        .icon { font-size: 1.8rem; margin-bottom: 5px; }
        .title { font-weight: bold; margin-bottom: 5px; font-size: 0.95rem; }
        .desc { font-size: 0.8rem; color: #555; }

        /* --- 5. ç¡®è®¤æŒ‰é’®åŒºåŸŸ --- */
        #action-bar {
            position: fixed; 
            bottom: 30px; 
            left: 50%; transform: translateX(-50%);
            width: auto;
            z-index: 100;
            pointer-events: none; 
        }

        #confirm-btn {
            pointer-events: auto;
            background-color: var(--btn-disabled);
            color: white; border: none;
            padding: 15px 0; 
            min-width: 220px; 
            width: 220px;
            border-radius: 50px;
            font-size: 1.1rem; font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.1s;
            cursor: not-allowed;
            white-space: nowrap; 
            text-align: center;
        }

        #confirm-btn.active {
            background-color: var(--blue-color);
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 86, 179, 0.4);
        }
        #confirm-btn.active:active { transform: scale(0.96); }

        /* --- 6. å¼¹çª—æ ·å¼ --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal {
            background: white; padding: 24px; border-radius: 28px;
            width: 85%; max-width: 360px; text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; align-items: center;
            box-sizing: border-box;
        }
        .modal-image-container { width: 100%; height: auto; display: none; margin-bottom: 10px; }
        .modal-image-container img { width: 100%; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .modal-icon-container { margin-top: 10px; margin-bottom: 20px; display: none; }
        .modal-content-area { padding: 15px 0 0 0; text-align: left; width: 100%; }
        .modal h2 { color: var(--modal-blue); margin: 0 0 15px 0; font-size: 1.3rem; font-weight: 900; }
        .modal p { color: var(--modal-text); line-height: 1.6; font-size: 0.9rem; margin-bottom: 12px; text-align: justify; }
        .label-bias, .label-fix { color: var(--modal-blue); font-weight: bold; font-size: 0.95rem; }
        
        .close-btn {
            background: var(--modal-blue); color: white; border: none; width: 140px;
            padding: 10px 0; border-radius: 50px; cursor: pointer;
            font-size: 0.9rem; font-weight: bold; margin-top: 25px;
            box-shadow: 0 6px 12px rgba(0, 86, 179, 0.3);
        }

        /* --- 7. çŠ¶æ€æ  & çˆ†ç‚¸ç‰¹æ•ˆ --- */
        #status-bar {
            margin-bottom: 15px; font-weight: bold;
            background: white; padding: 8px 20px;
            border-radius: 20px; color: var(--blue-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; gap: 20px; align-items: center; flex-wrap: wrap; justify-content: center;
        }
        #lives-container { color: #d32f2f; }

        #explosion-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(255,200,0,1) 0%, rgba(255,50,0,0.8) 50%, rgba(0,0,0,0.95) 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        #explosion-overlay.active { opacity: 1; pointer-events: all; animation: flash 0.5s ease-out; }
        .boom-text {
            font-size: 5rem; color: white; font-weight: 900; text-shadow: 0 0 20px black;
            transform: scale(0); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #explosion-overlay.active .boom-text { transform: scale(1); animation: shake 0.5s infinite; }
        .game-over-btn {
            margin-top: 50px; background: white; color: #d32f2f; border: none; padding: 15px 40px;
            font-size: 1.2rem; border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); opacity: 0; transform: translateY(20px);
            transition: opacity 0.5s 1s, transform 0.5s 1s;
        }
        #explosion-overlay.active .game-over-btn { opacity: 1; transform: translateY(0); }
        @keyframes flash { 0% { background: white; } 100% { background: radial-gradient(circle, rgba(255,69,0,1) 0%, rgba(0,0,0,1) 90%); } }

    </style>
</head>
<body>

    <h1>ğŸƒ ä¹ ä¿—é‡æ„ (Ritual Remix)</h1>
    <p class="instruction">
        <b>æ¸¸æˆè§„åˆ™æ›´æ–°ï¼š</b><br>
        1. ç¿»å¼€ä»»æ„ä¸¤å¼ å¡ç‰Œã€‚<br>
        2. è‹¥æƒ³æ›´æ¢ï¼Œç‚¹å‡»å·²ç¿»å¼€çš„å¡ç‰Œå°†å…¶ç›–å›ã€‚<br>
        3. ç¡®å®šé€‰æ‹©åï¼Œç‚¹å‡»åº•éƒ¨<b>â€œç¡®è®¤é…å¯¹â€</b>æŒ‰é’®ã€‚
    </p>
    
    <div id="status-bar">
        <div>å·²é…å¯¹: <span id="score">0</span> / 6</div>
        <div id="lives-container">ç”Ÿå‘½: <span id="lives">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span></div>
    </div>

    <div class="game-grid" id="gameGrid">
        </div>

    <div id="action-bar">
        <button id="confirm-btn" onclick="triggerConfirmMatch()">è¯·ç¿»å¼€ä¸¤å¼ ç‰Œ</button>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-image-container" id="modalImageContainer">
                <img id="modalImg" src="" alt="Explanation">
            </div>
            <div class="modal-icon-container" id="modalIconContainer">
                <div class="icon" id="modalIcon" style="font-size: 3rem;">âœ¨</div>
            </div>
            <div class="modal-content-area">
                <h2 id="modalTitle">æ ‡é¢˜</h2>
                <div id="modalText">å†…å®¹...</div>
            </div>
            <button class="close-btn" onclick="closeModal()">ç»§ç»­æ¸¸æˆ</button>
        </div>
    </div>

    <div id="explosion-overlay">
        <div class="boom-text">BOOM!</div>
        <div style="color: white; font-size: 1.2rem; margin-top: 20px; font-weight: bold;">ä»»åŠ¡å¤±è´¥ï¼Œå¡ç‰Œå·²é”€æ¯</div>
        <button class="game-over-btn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        // --- 1. æ¸¸æˆæ•°æ® ---
        const cardsData = [
            { id: '1a', pairId: 1, type: 'ritual', icon: 'ğŸšª', title: 'æ˜æš—ä¹‹åˆ†', desc: 'ç”·å£«å…¥æš—å®¤ï¼Œå¥³å£«è¿›æ˜å…ã€‚',
              modalTitle: 'ç©ºé—´åˆ»æ¿å°è±¡', modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">åè§ï¼š</span>è¿™ç§è®¾è®¡å¼ºåŒ–äº†ç”·æ€§åº”è¯¥â€œä¸¥è‚ƒæ·±æ²‰â€ï¼Œè€Œå¥³æ€§åº”è¯¥â€œä½œä¸ºè£…é¥°â€çš„åˆ»æ¿å°è±¡ã€‚<br><br><span class="label-fix">ä¿®æ­£ï¼š</span>åº”æ ¹æ®æƒ…æ„Ÿéœ€æ±‚ï¼ˆå¦‚ç§å¯†æ€§æˆ–ç¤¾äº¤æ€§ï¼‰è€Œéæ€§åˆ«åˆ†ç±»æ¥è®¾è®¡ç©ºé—´ã€‚' },
            { id: '1b', pairId: 1, type: 'rewrite', icon: 'ğŸŒ—', title: 'éšå¿ƒé€‰åº§', desc: 'æŒ‰ç§å¯†éœ€æ±‚è€Œéæ€§åˆ«è½åº§ã€‚',
              modalTitle: 'ç©ºé—´åˆ»æ¿å°è±¡', modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">åè§ï¼š</span>è¿™ç§è®¾è®¡å¼ºåŒ–äº†ç”·æ€§åº”è¯¥â€œä¸¥è‚ƒæ·±æ²‰â€ï¼Œè€Œå¥³æ€§åº”è¯¥â€œä½œä¸ºè£…é¥°â€çš„åˆ»æ¿å°è±¡ã€‚<br><br><span class="label-fix">ä¿®æ­£ï¼š</span>åº”æ ¹æ®æƒ…æ„Ÿéœ€æ±‚ï¼ˆå¦‚ç§å¯†æ€§æˆ–ç¤¾äº¤æ€§ï¼‰è€Œéæ€§åˆ«åˆ†ç±»æ¥è®¾è®¡ç©ºé—´ã€‚' },
            
            { id: '2a', pairId: 2, type: 'ritual', icon: 'ğŸª‘', title: 'é«˜èƒŒæ¤…', desc: 'åƒç”»æ¡†ä¸€æ ·æ¡†ä½å¥³æ€§ã€‚',
              modalTitle: 'è¢«å®¡è§†çš„è§†è§’', modalText: '<b>åè§ï¼š</b> éº¦é‡‘æ‰˜ä»€çš„é«˜èƒŒæ¤…åƒç”»æ¡†ä¸€æ ·å°†å¥³æ€§â€œæ¡†â€åœ¨å…¶ä¸­ï¼Œä½¿å…¶æˆä¸ºè¢«è§‚èµçš„å¯¹è±¡ã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾è®¡åº”ä¼˜å…ˆè€ƒè™‘èº«ä½“çš„èˆ’é€‚ä¸è‡ªç”±ï¼Œè€Œéè§†è§‰æ„å›¾ã€‚' },
            { id: '2b', pairId: 2, type: 'rewrite', icon: 'ğŸ›‹ï¸', title: 'èˆ’é€‚è‡³ä¸Š', desc: 'äººä½“å·¥å­¦ä¼˜äºè¢«è§‚èµæ€§ã€‚',
              modalTitle: 'è¢«å®¡è§†çš„è§†è§’', modalText: '<b>åè§ï¼š</b> éº¦é‡‘æ‰˜ä»€çš„é«˜èƒŒæ¤…åƒç”»æ¡†ä¸€æ ·å°†å¥³æ€§â€œæ¡†â€åœ¨å…¶ä¸­ï¼Œä½¿å…¶æˆä¸ºè¢«è§‚èµçš„å¯¹è±¡ã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾è®¡åº”ä¼˜å…ˆè€ƒè™‘èº«ä½“çš„èˆ’é€‚ä¸è‡ªç”±ï¼Œè€Œéè§†è§‰æ„å›¾ã€‚' },
            
            { id: '3a', pairId: 3, type: 'ritual', icon: 'ğŸ™Š', title: 'ä»–ç‚¹å•', desc: 'å…¬å…±åœºåˆç”±ç”·å£«ä»£åŠ³ç‚¹å•ã€‚',
              modalTitle: 'è¢«å™¤å£°çš„è‡ªä¸»æƒ', modalText: '<b>åè§ï¼š</b> ä¼ ç»Ÿç¤¼ä»ªåœ¨äº¤æ˜“å’Œç‚¹å•ç¯èŠ‚å‰¥å¤ºäº†å¥³æ€§ç›´æ¥å¯¹è¯çš„æƒåˆ©ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ä½¿ç”¨å½©çƒï¼ˆçº¢=èŒ¶ï¼Œè“=å’–å•¡ï¼‰ä½œä¸ºå®ç‰©ä»£ç ï¼Œè®©æ¯ä¸ªäººæ— éœ€å¼€å£å³å¯å¹³ç­‰è¡¨è¾¾éœ€æ±‚ã€‚' },
            { id: '3b', pairId: 3, type: 'rewrite', icon: 'ğŸ”´ğŸ”µ', title: 'å½©çƒæš—å·', desc: 'å®ç‰©ç¼–ç å®ç°å¹³ç­‰å‘å£°ã€‚',
              modalTitle: 'è¢«å™¤å£°çš„è‡ªä¸»æƒ', modalText: '<b>åè§ï¼š</b> ä¼ ç»Ÿç¤¼ä»ªåœ¨äº¤æ˜“å’Œç‚¹å•ç¯èŠ‚å‰¥å¤ºäº†å¥³æ€§ç›´æ¥å¯¹è¯çš„æƒåˆ©ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ä½¿ç”¨å½©çƒï¼ˆçº¢=èŒ¶ï¼Œè“=å’–å•¡ï¼‰ä½œä¸ºå®ç‰©ä»£ç ï¼Œè®©æ¯ä¸ªäººæ— éœ€å¼€å£å³å¯å¹³ç­‰è¡¨è¾¾éœ€æ±‚ã€‚' },
            
            { id: '4a', pairId: 4, type: 'ritual', icon: 'ğŸ—£ï¸', title: 'é—²è¨€ç¢è¯­', desc: 'èŒ¶å®¤è°ˆè¯è¢«è§†ä¸ºçç¢é—²èŠã€‚',
              modalTitle: 'è¯é¢˜è´¬ä½', modalText: '<b>åè§ï¼š</b> å°†å¥³æ€§çš„ç¤¾äº¤ç½‘ç»œè´¬ä½ä¸ºâ€œå…«å¦â€ï¼Œè€Œç”·æ€§çš„è°ˆè¯åˆ™æ˜¯â€œç”Ÿæ„â€ã€‚<br><br><b>ä¿®æ­£ï¼š</b> å°†ç©ºé—´é‡å¡‘ä¸ºåˆ›æ„ä¼šè®®å®¤ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰å½¢å¼çš„å¯¹è¯éƒ½å…·æœ‰åŒç­‰ä»·å€¼ã€‚' },
            { id: '4b', pairId: 4, type: 'rewrite', icon: 'ğŸ¤', title: 'ç¤¾åŒºä¸­å¿ƒ', desc: 'æ‰€æœ‰å¯¹è¯çš†æœ‰ä»·å€¼ã€‚',
              modalTitle: 'è¯é¢˜è´¬ä½', modalText: '<b>åè§ï¼š</b> å°†å¥³æ€§çš„ç¤¾äº¤ç½‘ç»œè´¬ä½ä¸ºâ€œå…«å¦â€ï¼Œè€Œç”·æ€§çš„è°ˆè¯åˆ™æ˜¯â€œç”Ÿæ„â€ã€‚<br><br><b>ä¿®æ­£ï¼š</b> å°†ç©ºé—´é‡å¡‘ä¸ºåˆ›æ„ä¼šè®®å®¤ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰å½¢å¼çš„å¯¹è¯éƒ½å…·æœ‰åŒç­‰ä»·å€¼ã€‚' },
            
            { id: '5a', pairId: 5, type: 'ritual', icon: 'ğŸ‘—', title: 'æ´»ä½“è£…é¥°', desc: 'å¥³ä¾è€…ä¸å¢™å£èä¸ºä¸€ä½“ã€‚',
              modalTitle: 'ç¾å­¦åŠ³å½¹', modalText: '<b>åè§ï¼š</b> è¿™ç§è®¾è®¡å°†æœåŠ¡äººå‘˜è§†ä¸ºç¯å¢ƒä¸­çš„è£…é¥°æ‘†è®¾ï¼Œè€ŒéèŒä¸šåŠ³åŠ¨è€…ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ç™½è‰²ä¿¡å·çƒä»£è¡¨â€œéœ€è¦æœåŠ¡â€ã€‚è¿™ä½¿è§’è‰²ä»è¢«åŠ¨çš„ä¾ä»è½¬å˜ä¸ºä¸»åŠ¨å“åº”çš„ä¸“ä¸šäººå‘˜ã€‚' },
            { id: '5b', pairId: 5, type: 'rewrite', icon: 'âšª', title: 'ç™½è‰²ä¿¡å·çƒ', desc: 'æŒ‰éœ€æœåŠ¡ï¼Œè€Œéå±•ç¤ºã€‚',
              modalTitle: 'ç¾å­¦åŠ³å½¹', modalText: '<b>åè§ï¼š</b> è¿™ç§è®¾è®¡å°†æœåŠ¡äººå‘˜è§†ä¸ºç¯å¢ƒä¸­çš„è£…é¥°æ‘†è®¾ï¼Œè€ŒéèŒä¸šåŠ³åŠ¨è€…ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ç™½è‰²ä¿¡å·çƒä»£è¡¨â€œéœ€è¦æœåŠ¡â€ã€‚è¿™ä½¿è§’è‰²ä»è¢«åŠ¨çš„ä¾ä»è½¬å˜ä¸ºä¸»åŠ¨å“åº”çš„ä¸“ä¸šäººå‘˜ã€‚' },
            
            { id: '6a', pairId: 6, type: 'ritual', icon: 'ğŸ§¾', title: 'è´¦å•', desc: 'è´¦å•è‡ªåŠ¨é€’ç»™ç”·å£«ã€‚',
              modalTitle: 'ç»æµä¾é™„', modalText: '<b>åè§ï¼š</b> é»˜è®¤é¢„è®¾ç”·æ€§ä¸ºå”¯ä¸€çš„â€œä¾›å…»è€…â€æˆ–ä¹°å•äººã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾ç½®ä¸­ç«‹æ”¯ä»˜åŒºæˆ–äºŒç»´ç ï¼Œä½¿ä»˜æ¬¾æˆä¸ºä¸€ç§ç§å¯†çš„ã€åŠŸèƒ½æ€§çš„è¡Œä¸ºï¼Œè€Œéä¸€ç§æ€§åˆ«è¡¨æ¼”ã€‚' },
            { id: '6b', pairId: 6, type: 'rewrite', icon: 'ğŸ“±', title: 'ä¸­ç«‹æ”¯ä»˜', desc: 'ä¸­å¤®åŒºåŸŸï¼Œç§å¯†æ”¯ä»˜ã€‚',
              modalTitle: 'ç»æµä¾é™„', modalText: '<b>åè§ï¼š</b> é»˜è®¤é¢„è®¾ç”·æ€§ä¸ºå”¯ä¸€çš„â€œä¾›å…»è€…â€æˆ–ä¹°å•äººã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾ç½®ä¸­ç«‹æ”¯ä»˜åŒºæˆ–äºŒç»´ç ï¼Œä½¿ä»˜æ¬¾æˆä¸ºä¸€ç§ç§å¯†çš„ã€åŠŸèƒ½æ€§çš„è¡Œä¸ºï¼Œè€Œéä¸€ç§æ€§åˆ«è¡¨æ¼”ã€‚' }
        ];

        // --- 2. æ¸¸æˆé€»è¾‘ ---
        const grid = document.getElementById('gameGrid');
        const modalOverlay = document.getElementById('modalOverlay');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const confirmBtn = document.getElementById('confirm-btn');
        const explosionOverlay = document.getElementById('explosion-overlay');
        
        let cards = [];
        let score = 0;
        let lives = 5;
        const maxLives = 5;
        let selectedCards = []; 
        let lockBoard = false;

        function initGame() {
            cards = [...cardsData].sort(() => 0.5 - Math.random());
            grid.innerHTML = '';
            
            lives = maxLives;
            score = 0;
            scoreEl.textContent = score;
            updateLivesDisplay();
            resetSelection(); 
            lockBoard = false;

            cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.classList.add('card');
                cardEl.dataset.pairId = card.pairId;
                cardEl.dataset.type = card.type;
                cardEl.dataset.modalTitle = card.modalTitle;
                cardEl.dataset.modalText = card.modalText;
                if(card.modalImage) cardEl.dataset.modalImage = card.modalImage;

                const frontContent = `
                    <div class="front">
                        <span style="font-size:1.5rem;">?</span>
                        <span>${card.type === 'ritual' ? 'æ—§è§„' : 'æ–°è§£'}</span>
                    </div>
                `;

                let backContent = '';
                if (card.image) {
                    backContent = `
                        <div class="back" style="padding: 0; border: none; overflow: hidden;">
                            <img src="${card.image}" alt="${card.title}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                        </div>
                    `;
                } else {
                    backContent = `
                        <div class="back">
                            <div class="icon">${card.icon}</div>
                            <div class="title">${card.title}</div>
                            <div class="desc">${card.desc}</div>
                        </div>
                    `;
                }

                cardEl.innerHTML = frontContent + backContent;
                
                // ä½¿ç”¨ CSS touch-action å¤„ç†ç§»åŠ¨ç«¯ç‚¹å‡»ï¼Œé¿å…å¤æ‚çš„ JS å†²çª
                cardEl.addEventListener('click', handleCardClick);
                grid.appendChild(cardEl);
            });
        }

        function updateLivesDisplay() {
            let hearts = '';
            for(let i=0; i<maxLives; i++) {
                hearts += (i < lives) ? 'â¤ï¸' : 'ğŸ’”';
            }
            livesEl.textContent = hearts;
        }

        function handleCardClick(e) {
            if (lockBoard) return;
            
            const card = e.currentTarget;

            if (card.classList.contains('matched')) {
                showModal(card.dataset.modalTitle, card.dataset.modalText, card.dataset.modalImage);
                return;
            }

            // ç‚¹å‡»å·²ç¿»å¼€ -> ç›–å›å»
            if (card.classList.contains('flip')) {
                card.classList.remove('flip');
                selectedCards = selectedCards.filter(c => c !== card);
                updateConfirmButton();
                return;
            }

            // ç‚¹å‡»æœªç¿»å¼€ -> ç¿»å¼€
            if (selectedCards.length < 2) {
                card.classList.add('flip');
                selectedCards.push(card);
                updateConfirmButton();
            } else {
                // ã€æ ¸å¿ƒä¿®å¤ã€‘ä½¿ç”¨ CSS class è¿›è¡Œéœ‡åŠ¨ï¼Œé˜²æ­¢ style å†²çªå¯¼è‡´å¡ç‰Œé”æ­»
                card.classList.add('denying');
                setTimeout(() => card.classList.remove('denying'), 300);
            }
        }

        function updateConfirmButton() {
            if (selectedCards.length === 2) {
                confirmBtn.classList.add('active');
                confirmBtn.textContent = "ç¡®è®¤é…å¯¹";
            } else {
                confirmBtn.classList.remove('active');
                confirmBtn.textContent = selectedCards.length === 1 ? "è¯·å†ç¿»ä¸€å¼ " : "è¯·ç¿»å¼€ä¸¤å¼ ç‰Œ";
            }
        }

        function triggerConfirmMatch() {
            if (lockBoard || selectedCards.length !== 2) return;

            const card1 = selectedCards[0];
            const card2 = selectedCards[1];

            if (card1.dataset.pairId === card2.dataset.pairId) {
                // é…å¯¹æˆåŠŸ
                card1.classList.add('matched');
                card2.classList.add('matched');
                
                // ã€æ ¸å¿ƒä¿®å¤ã€‘è®¡ç®—çœŸå®å¾—åˆ†ï¼Œé˜²æ­¢ç–¯ç‹‚ç‚¹å‡»å¯¼è‡´åˆ†æ•°é”™è¯¯
                const matchedCount = document.querySelectorAll('.card.matched').length;
                score = matchedCount / 2;
                scoreEl.textContent = score;

                showModal(card1.dataset.modalTitle, card1.dataset.modalText, card1.dataset.modalImage);
                
                resetSelection();
                if(score === 6) {
                    setTimeout(() => alert("ğŸ‰ æ­å–œï¼æ‰€æœ‰æ—§ä¿—å·²å®Œæˆé‡æ„ï¼"), 800);
                }
            } else {
                // é…å¯¹å¤±è´¥
                lockBoard = true;
                lives--;
                updateLivesDisplay();
                document.body.classList.add('shake-screen');
                setTimeout(() => document.body.classList.remove('shake-screen'), 500);

                confirmBtn.classList.remove('active');
                confirmBtn.style.backgroundColor = "#d32f2f";
                confirmBtn.textContent = "é…å¯¹é”™è¯¯ï¼ç”Ÿå‘½-1";

                setTimeout(() => {
                    confirmBtn.style.backgroundColor = ""; 
                    
                    if (lives <= 0) {
                        triggerExplosion();
                    } else {
                        card1.classList.remove('flip');
                        card2.classList.remove('flip');
                        resetSelection();
                        lockBoard = false;
                    }
                }, 1000);
            }
        }

        function resetSelection() {
            selectedCards = [];
            updateConfirmButton();
        }

        function triggerExplosion() {
            explosionOverlay.classList.add('active');
            grid.style.opacity = '0';
            confirmBtn.style.display = 'none';
        }

        function showModal(title, text, image) {
            const imgContainer = document.getElementById('modalImageContainer');
            const iconContainer = document.getElementById('modalIconContainer');
            const modalImg = document.getElementById('modalImg');

            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerHTML = text; 

            if (image) {
                imgContainer.style.display = 'block';
                iconContainer.style.display = 'none';
                modalImg.src = image; 
            } else {
                imgContainer.style.display = 'none';
                iconContainer.style.display = 'block';
            }
            modalOverlay.classList.add('active');
        }

        function closeModal() {
            modalOverlay.classList.remove('active');
        }

        initGame();
    </script>
</body>
</html>
