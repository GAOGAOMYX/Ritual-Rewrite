<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ritual Rewrite</title>
    <style>
        /* --- 1. åŸºç¡€å˜é‡ --- */
        :root {
            --red-color: #8B0000;
            --blue-color: #582a57;
            --green-color: #2E7D32;
            --bg-color: #f4f4f4;
            --modal-blue: #582a57;
            --modal-text: #4a5568;
            --btn-disabled: #cccccc;
            --review-btn-color: #582a57;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100dvh; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- 2. åŠ¨ç”»æ•ˆæœ --- */
        .shake-screen {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        @keyframes cardDeny {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        .card.denying {
            animation: cardDeny 0.3s ease-in-out;
        }

        /* --- æ–°å¢ï¼šé…å¯¹æˆåŠŸæç¤ºæ ·å¼ --- */
        #success-toast {
            position: fixed;
            top: 45%; /* æ˜¾ç¤ºåœ¨å±å¹•æ­£ä¸­é—´ç¨å¾®åä¸Š */
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background-color: rgba(46, 125, 50, 0.95); /* æ·±ç»¿è‰²èƒŒæ™¯ */
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: 900;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 4000; /* ç¡®ä¿åœ¨å¡ç‰Œä¹‹ä¸Š */
            pointer-events: none; /* é˜²æ­¢é®æŒ¡ç‚¹å‡» */
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #success-toast.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1); /* å¼¹å‡ºçš„æ”¾å¤§æ•ˆæœ */
        }

        /* --- 3. Landing Page Styles (NEW) --- */
        #landing-page {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('bg.jpg') no-repeat center center; /* èƒŒæ™¯å›¾ç‰‡ */
            background-size: cover;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5000; /* æœ€é«˜å±‚çº§ */
            background-color: #f4f4f4; /* å›¾ç‰‡åŠ è½½å‰çš„åº•è‰² */
        }

        #landing-title {
            font-size: 2.5rem;
            color: #333;
            font-weight: 900;
            margin-bottom: 40px;
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
            text-align: center;
        }

        .difficulty-container {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .diff-btn {
            padding: 15px 30px;
            border: 2px solid var(--blue-color);
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--blue-color);
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
            text-align: center;
        }

        .diff-btn.selected {
            background: var(--blue-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(88, 42, 87, 0.4);
        }

        #landing-start-btn {
            padding: 15px 60px;
            background-color: var(--btn-disabled);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: not-allowed;
            transition: all 0.3s;
            margin-bottom: 20px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        #landing-start-btn.ready {
            background-color: var(--green-color);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.4);
        }

        #landing-rules-btn {
            background: transparent;
            border: none;
            text-decoration: underline;
            color: #555;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- Game Container (Hidden initially) --- */
        #game-container {
            display: none; /* é»˜è®¤éšè—ï¼Œç­‰å¾…å¼€å§‹ */
            width: 100%;
            flex-direction: column;
            align-items: center;
            padding-bottom: 150px;
        }

        h1 { margin-top: 20px; font-size: 1.5rem; color: #333; text-align: center; }

        p.instruction {
            font-size: 0.9rem; color: #666; text-align: center;
            margin-bottom: 15px; padding: 0 20px; max-width: 600px; line-height: 1.5;
        }

        /* --- 4. Game Grid & Cards --- */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 600px; width: 95%;
            perspective: 1000px;
            margin-bottom: 20px;
            position: relative; 
            z-index: 10;
        }
        @media (min-width: 600px) {
            .game-grid { grid-template-columns: repeat(4, 1fr); gap: 15px; }
        }

        .card {
            background-color: transparent; height: 190px;
            cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s;
            z-index: 11;
            touch-action: manipulation; 
            -webkit-user-select: none;
            user-select: none;
        }

        .card.flip { transform: rotateY(180deg); }

        .front, .back {
            width: 100%; height: 100%; position: absolute;
            border-radius: 0px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            padding: 8px; box-sizing: border-box; backface-visibility: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-size: 0.9rem; line-height: 1.3;
            pointer-events: none; 
        }

        .front {
            background-color: transparent; border-radius: 0px; overflow: hidden; border: none;
        }
        .card[data-type="ritual"] .front { background: url('cover-red.jpg') no-repeat center center; background-size: cover; }
        .card[data-type="rewrite"] .front { background: url('cover-blue.jpg') no-repeat center center; background-size: cover; }

        .back {
            background-color: white; transform: rotateY(180deg);
            border: 0px solid #ddd; padding-bottom: 25px;
        }
        .card[data-type="ritual"] .back { border-top: 8px solid var(--red-color); color: var(--red-color); }
        .card[data-type="rewrite"] .back { border-top: 8px solid var(--blue-color); color: var(--blue-color); }

        .card.flip .back { box-shadow: 0 8px 20px rgba(0,0,0,0.15); }

        .card.matched .back {
            border-color: var(--green-color); 
            box-shadow: 0 0 10px rgba(46, 125, 50, 0.3);
            pointer-events: auto;
        }
        
        /* Review Button Style */
        .card.matched .back::after {
            content: "review";
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            font-size: 0.85rem; font-weight: bold;
            background-color: var(--review-btn-color); color: white;
            padding: 5px 20px; border-radius: 20px;
            white-space: nowrap; box-shadow: none;
            animation: fadeIn 0.5s ease-in-out;
            pointer-events: auto; z-index: 5;
        }

        .text-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; border: none;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 10px 15px 65px 15px; 
            box-sizing: border-box; z-index: 2; pointer-events: none;
        }
        .text-overlay .card-title {
            font-weight: 900; font-size: 1rem; color: #000; margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
        }
        .text-overlay .card-desc {
            font-size: 0.80rem; color: #333; line-height: 1.3; font-weight: bold;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            
        }
        .text-overlay .card-icon {
            font-size: 2.5rem; margin-bottom: 10px;
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.8)); 
        }

        /* --- 5. UI Elements --- */
        #action-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: auto; z-index: 100; pointer-events: none; 
        }
        #confirm-btn {
            pointer-events: auto; background-color: var(--btn-disabled);
            color: white; border: none; padding: 15px 0; min-width: 220px; width: 220px;
            border-radius: 50px; font-size: 1.1rem; font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: background-color 0.3s, transform 0.1s;
            cursor: not-allowed; white-space: nowrap; text-align: center;
        }
        #confirm-btn.active {
            background-color: var(--blue-color); cursor: pointer;
            box-shadow: 0 8px 20px #582a57;
        }
        #confirm-btn.active:active { transform: scale(0.96); }

        #status-bar {
            margin-bottom: 15px; font-weight: bold;
            background: white; padding: 8px 20px;
            border-radius: 20px; color: var(--blue-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; gap: 20px; align-items: center; flex-wrap: wrap; justify-content: center;
        }
        #rules-btn {
            background: transparent; border: 2px solid var(--blue-color);
            color: var(--blue-color); padding: 4px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.2s; margin-left: 10px;
        }
        #lives-container { color: #d32f2f; }

        /* --- 6. Overlays --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal {
            background: white; padding: 24px; border-radius: 28px;
            width: 85%; max-width: 360px; text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; align-items: center; box-sizing: border-box;
        }
        .modal-image-container { width: 100%; height: auto; display: none; margin-bottom: 10px; }
        .modal-image-container img { width: 100%; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .modal-content-area { padding: 15px 0 0 0; text-align: left; width: 100%; }
        .modal h2 { color: var(--modal-blue); margin: 0 0 15px 0; font-size: 1.3rem; font-weight: 900; }
        .modal p { color: var(--modal-text); line-height: 1.6; font-size: 0.9rem; margin-bottom: 12px; text-align: justify; }
        .label-bias, .label-fix { color: var(--modal-blue); font-weight: bold; font-size: 0.95rem; }
        .close-btn {
            background: var(--modal-blue); color: white; border: none; width: 140px;
            padding: 10px 0; border-radius: 50px; cursor: pointer;
            font-size: 0.9rem; font-weight: bold; margin-top: 25px; box-shadow: 0 6px 12px #582a57;
        }

        #explosion-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(255,200,0,1) 0%, rgba(255,50,0,0.8) 50%, rgba(0,0,0,0.95) 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        #explosion-overlay.active { opacity: 1; pointer-events: all; animation: flash 0.5s ease-out; }
        .boom-text {
            font-size: 5rem; color: white; font-weight: 900; text-shadow: 0 0 20px black;
            transform: scale(0); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #explosion-overlay.active .boom-text { transform: scale(1); animation: shake 0.5s infinite; }
        .game-over-btn {
            margin-top: 50px; background: white; color: #d32f2f; border: none; padding: 15px 40px;
            font-size: 1.2rem; border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); opacity: 0; transform: translateY(20px);
            transition: opacity 0.5s 1s, transform 0.5s 1s;
        }
        #explosion-overlay.active .game-over-btn { opacity: 1; transform: translateY(0); }
        @keyframes flash { 0% { background: white; } 100% { background: radial-gradient(circle, rgba(255,69,0,1) 0%, rgba(0,0,0,1) 90%); } }
        
        #rules-image { width: 100%; height: auto; border-radius: 10px; display: block; }
        
        #back-btn {
            background: transparent;
            border: 2px solid var(--blue-color);
            color: var(--blue-color);
            padding: 4px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px; /* å³è¾¹ç•™ç‚¹ç©ºéš™ */
        }

        #back-btn:active {
            background: var(--blue-color);
            color: white;
        }

        /* --- æ–°å¢ï¼šå½©å¸¦ç²’å­åŠ¨ç”» --- */
        .confetti {
            position: fixed;
            top: -20px; /* ä»å±å¹•ä¸Šæ–¹å¼€å§‹ */
            width: 10px;
            height: 10px;
            z-index: 5000; /* ä¿è¯åœ¨æœ€é¡¶å±‚ */
            pointer-events: none; /* ä¸æŒ¡é¼ æ ‡ç‚¹å‡» */
            opacity: 0.8;
        }

        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } /* ä¸‹è½åˆ°åº•éƒ¨å¹¶æ—‹è½¬ */
        }

        /* =========================================
           ğŸ“± ç§»åŠ¨ç«¯é€‚é…ä»£ç  (Mobile Optimization)
           é’ˆå¯¹ iPhone 14 åŠå…¶ä»–æ‰‹æœºå±å¹•çš„ä¿®å¤
           ========================================= */
        @media screen and (max-width: 600px) {
            
            /* 1. è°ƒæ•´ç½‘æ ¼é—´è·ï¼Œè®©å¡ç‰‡ç¨å¾®å®½ä¸€ç‚¹ */
            .game-grid {
                width: 98%; /* å æ»¡æ›´å¤šå±å¹•å®½åº¦ */
                gap: 8px;   /* å‡å°å¡ç‰‡ä¹‹é—´çš„ç¼éš™ */
            }

            /* 2. è°ƒæ•´å¡ç‰‡é«˜åº¦ï¼Œä¿æŒæ¯”ä¾‹ */
            .card {
                height: 170px; /* ç¨å¾®å‡å°é«˜åº¦ï¼Œé€‚é…è§†çº¿ */
            }

            /* 3. å‹ç¼©æ–‡å­—å±‚çš„å†…è¾¹è·ï¼Œç»™æ–‡å­—ç•™å‡ºæ›´å¤šç©ºé—´ */
            .text-overlay {
                /* ä¸Šå·¦å³å†…è¾¹è·å‡å°ï¼Œåº•éƒ¨ç•™ç™½ä» 65px å‡å°åˆ° 40px */
                padding: 5px 4px 40px 4px; 
            }

            /* 4. ç¼©å°å›¾æ ‡ */
            .text-overlay .card-icon {
                font-size: 1.8rem; /* ä» 2.5rem ç¼©å° */
                margin-bottom: 4px;
            }

            /* 5. ç¼©å°æ ‡é¢˜ */
            .text-overlay .card-title {
                font-size: 0.85rem; /* ç¼©å°å­—å· */
                line-height: 1.1;
                margin-bottom: 4px;
                -webkit-line-clamp: 2; /* é™åˆ¶æ ‡é¢˜æœ€å¤š2è¡Œ */
            }

            /* 6. ç¼©å°æè¿°æ–‡å­—ï¼Œå¢åŠ è¡Œæ•°é™åˆ¶ */
            .text-overlay .card-desc {
                font-size: 0.65rem; /* ç¼©å°å­—å·ä»¥æ˜¾ç¤ºæ›´å¤šå†…å®¹ */
                line-height: 1.2;
                -webkit-line-clamp: 5; /* å…è®¸æ˜¾ç¤ºæ›´å¤šè¡Œæ•° (ä¹‹å‰æ˜¯4) */
            }

            /* 7. è°ƒæ•´ Review æŒ‰é’®çš„ä½ç½®å’Œå¤§å° */
            .card.matched .back::after {
                font-size: 0.7rem;   /* æŒ‰é’®æ–‡å­—å˜å° */
                padding: 4px 12px;   /* æŒ‰é’®å°ºå¯¸å˜å° */
                bottom: 10px;        /* æŒ‰é’®æ›´é ä¸‹ï¼Œç»™æ–‡å­—è…¾åœ°æ–¹ */
                border-radius: 15px;
            }

            /* 8. è°ƒæ•´è½åœ°é¡µæ ‡é¢˜å¤§å°ï¼Œé˜²æ­¢æ¢è¡Œå¤ªéš¾çœ‹ */
            #landing-title {
                font-size: 2rem;
                margin-bottom: 30px;
            }
            
            /* 9. è°ƒæ•´åº•éƒ¨æ“ä½œæ ä½ç½® */
            #action-bar {
                bottom: 20px;
            }
            
            /* 10. è°ƒæ•´ç¡®è®¤æŒ‰é’®å¤§å° */
            #confirm-btn {
                min-width: 180px;
                width: 180px;
                font-size: 1rem;
                padding: 12px 0;
            }
        }
    </style>
</head>
<body>

    <div id="landing-page">
        <div id="landing-title">Ritual Rewrite</div>
        
        <div class="difficulty-container">
            <button class="diff-btn" onclick="selectDifficulty('simple')">Level 1</button>
            <button class="diff-btn" onclick="selectDifficulty('normal')">Level 2</button>
        </div>

        <button id="landing-start-btn" onclick="startGame()">Start Game</button>
        
    </div>

    <div id="success-toast">Perfect Match! ğŸ‰</div>

    <div id="game-container">
        <h1>Ritual Rewrite</h1>
        <div id="status-bar">
            <button id="back-btn" onclick="backToMenu()">Back</button>
            <div>Matched: <span id="score">0</span> / 6</div>
            <div id="lives-container">Lives: <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></div>
            <button id="rules-btn" onclick="openRules()">Rules</button>
        </div>

        <div class="game-grid" id="gameGrid">
            </div>

        <div id="action-bar">
            <button id="confirm-btn" onclick="triggerConfirmMatch()">Please flip 2 cards</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-image-container" id="modalImageContainer">
                <img id="modalImg" src="" alt="Explanation">
            </div>
            <div class="modal-icon-container" id="modalIconContainer">
                <div class="icon" id="modalIcon" style="font-size: 3rem;">âœ¨</div>
            </div>
            <div class="modal-content-area">
                <h2 id="modalTitle">æ ‡é¢˜</h2>
                <div id="modalText">å†…å®¹...</div>
            </div>
            <button class="close-btn" onclick="closeModal()">Continue</button>
        </div>
    </div>

    <div id="explosion-overlay">
        <div class="boom-text">BOOM!</div>
        <div style="color: white; font-size: 1.2rem; margin-top: 20px; font-weight: bold;">Mission Failed. Cards Destroyed.</div>
        <button class="game-over-btn" onclick="location.reload()">Restart</button>
    </div>

    <div class="modal-overlay" id="rulesOverlay">
        <div class="modal">
            <img id="rules-image" src="rules.jpg" alt="Game Rules">
            <button class="close-btn" onclick="closeRules()">Close</button>
        </div>
    </div>

    <script>
        // --- 1. æ•°æ®é›†åˆ†ç¦» ---
        
        // éš¾åº¦ï¼šæ™®é€š (Hard/Normal text from your prompt)
        const dataNormal = [
            // Pair 1 (Space - Light/Dark)
            { id: '1a', pairId: 1, type: 'ritual', icon: '', title: 'Light/Dark Spaces', desc: 'Menâ€™s rooms were darker; womenâ€™s rooms were brighter.',
              modalTitle: 'Divided by Gender â†’ Choice by Mood', image: 'card1-red1.jpg', modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">Bias: </span>In the past, men\'s spaces were often designed to be darker to create a serious, focused atmosphere suitable for business talks and contemplation. Women\'s spaces, on the other hand, were brighter and more relaxed, making it easier for socializing and personal grooming.<br><br><span class="label-fix">Fix: </span>Spaces no longer need to be divided by genderâ€”people can freely choose different rooms and lighting based on their needs.' },
            { id: '1b', pairId: 1, type: 'rewrite', icon: '', title: 'Choose by Mood', desc: 'No one belongs to a specific room.',
              modalTitle: 'Divided by Gender â†’ Choice by Mood', image: 'card1-blue1.jpg', modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">Bias: </span>In the past, men\'s spaces were often designed to be darker to create a serious, focused atmosphere suitable for business talks and contemplation. Women\'s spaces, on the other hand, were brighter and more relaxed, making it easier for socializing and personal grooming.<br><br><span class="label-fix">Fix: </span>Spaces no longer need to be divided by genderâ€”people can freely choose different rooms and lighting based on their needs.' },
            
            // Pair 2 (Updated: Missing Names)
            { id: '2a', pairId: 2, type: 'ritual', icon: '', title: 'Missing Names', desc: 'Thereâ€™s space on the list, but it rarely carries their names.',
              modalTitle: 'Hidden Labor â†’ Proud Signatures', image: 'card1-red1.jpg', modalImage: 'Pair 2.jpg', modalText: '<span class="label-bias">Bias: </span>For a long time, women contributed to design, service, and creative work, but their names were rarely shown. Men signed the ideas. Womenâ€™s labor stayed invisible and undervalued.<br><br><span class="label-fix">Fix: </span>In places like the Willow Tea Rooms, women began to have their names written on menus, design work, and management roles. Their contributions were seen as professional Their handwriting finally appeared where it belonged.' },
            { id: '2b', pairId: 2, type: 'rewrite', icon: '', title: 'Her Signature', desc: 'She appears on menus, designs and ownership signs.',
              modalTitle: 'Hidden Labor â†’ Proud Signatures', image: 'card1-blue1.jpg', modalImage: 'Pair 2.jpg', modalText: '<span class="label-bias">Bias: </span>For a long time, women contributed to design, service, and creative work, but their names were rarely shown. Men signed the ideas. Womenâ€™s labor stayed invisible and undervalued.<br><br><span class="label-fix">Fix: </span>In places like the Willow Tea Rooms, women began to have their names written on menus, design work, and management roles. Their contributions were seen as professional Their handwriting finally appeared where it belonged.' },
            
            // Pair 3 (Updated: Built for Men)
            { id: '3a', pairId: 3, type: 'ritual', icon: '', title: 'Built for Men', desc: 'High stools, dark wooden tables, rough decorations',
              modalTitle: 'Male-Centric Design â†’ Comfort for Her', image: 'card1-red1.jpg', modalImage: 'Pair 3.jpg', modalText: '<span class="label-bias">Bias: </span>Historical public spaces were designed around male habits: tall stools, heavy dark furniture, smoky air, low lighting. Women often felt out of place, uncomfortable, or unsafe.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms transformed the environment. Mackintosh used light-colored wood,  floral motifs, patterned glass, bright palettes, and soft lighting to create a space where women could sit comfortably, see and be seen, and participate equally in public life.' },
            { id: '3b', pairId: 3, type: 'rewrite', icon: '', title: 'Designed for Her', desc: 'soft chandeliers and bright colors reshape the room.',
              modalTitle: 'Male-Centric Design â†’ Comfort for Her', image: 'card1-blue1.jpg', modalImage: 'Pair 3.jpg', modalText: '<span class="label-bias">Bias: </span>Historical public spaces were designed around male habits: tall stools, heavy dark furniture, smoky air, low lighting. Women often felt out of place, uncomfortable, or unsafe.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms transformed the environment. Mackintosh used light-colored wood,  floral motifs, patterned glass, bright palettes, and soft lighting to create a space where women could sit comfortably, see and be seen, and participate equally in public life.' },
            
            // Pair 4 (Gossip)
            { id: '4a', pairId: 4, type: 'ritual', icon: '', title: 'Gossip', desc: 'Womenâ€™s discussions were often considered as gossip.',
              modalTitle: 'Dismissed Gossip â†’ Civic Power', image: 'card1-red1.jpg', modalImage: 'Pair 4.jpg', modalText: '<span class="label-bias">Bias: </span>Before the 20th century, women were not allowed to discuss politics, and their conversations were usually limited to daily life, often dismissed as gossip.<br><br><span class="label-fix">Fix: </span>At the Willow Tea Rooms, women not only exchanged information but also shared opinions. The tea room became a public forum, witnessing the exercise of civic rights.' },
            { id: '4b', pairId: 4, type: 'rewrite', icon: '', title: 'Public Forum', desc: 'More and more decisions began to include womenâ€™s voices.',
              modalTitle: 'Dismissed Gossip â†’ Civic Power', image: 'card1-blue1.jpg', modalImage: 'Pair 4.jpg', modalText: '<span class="label-bias">Bias: </span>Before the 20th century, women were not allowed to discuss politics, and their conversations were usually limited to daily life, often dismissed as gossip.<br><br><span class="label-fix">Fix: </span>At the Willow Tea Rooms, women not only exchanged information but also shared opinions. The tea room became a public forum, witnessing the exercise of civic rights.' },
            
            // Pair 5 (Service - Invisible Service)
            { id: '5a', pairId: 5, type: 'ritual', icon: '', title: 'Invisible Service', desc: 'Servers wore the same color as the walls.',
              modalTitle: 'Living Decoration â†’ Respected Professional', image: 'card1-red1.jpg', modalImage: 'Pair 5.jpg', modalText: '<span class="label-bias">Bias: </span>In the early days, female servers were not seen as professionals to be noticed. They were expected to stay quiet and not disturb customers. Their uniforms often matched the walls, making them blend in and hard to see.<br><br><span class="label-fix">Fix: </span>Today, servers are respected professionals and donâ€™t need to stay hidden. Their uniforms have different colors to show their roles, making them easier for customers to see and appreciate.' },
            { id: '5b', pairId: 5, type: 'rewrite', icon: '', title: 'Visible Roles', desc: 'Guests can easily see where the servers are.',
              modalTitle: 'Living Decoration â†’ Respected Professional', image: 'card1-blue1.jpg', modalImage: 'Pair 5.jpg', modalText: '<span class="label-bias">Bias: </span>In the early days, female servers were not seen as professionals to be noticed. They were expected to stay quiet and not disturb customers. Their uniforms often matched the walls, making them blend in and hard to see.<br><br><span class="label-fix">Fix: </span>Today, servers are respected professionals and donâ€™t need to stay hidden. Their uniforms have different colors to show their roles, making them easier for customers to see and appreciate.' },
            
            // Pair 6 (Updated: Forbidden Glass)
            { id: '6a', pairId: 6, type: 'ritual', icon: '', title: 'Forbidden Glass', desc: 'Men Cheers freely, while women stay cautious.',
              modalTitle: 'Exclusive Pubs â†’ Inclusive Safe Space', image: 'card1-red1.jpg', modalImage: 'Pair 6.jpg', modalText: '<span class="label-bias">Bias: </span>Historically, drinking in public was considered a â€œmale activity.â€Bars and pubs were loud and unsafe for women. This made public social life unequal, as women could not participate freely or stay for long.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms created a different type of public space:Â bright, calm, and entirely alcohol-free, open to everyone regardless of gender. Both women and men could sit, talk, and spend time without the alcohol culture.' },
            { id: '6b', pairId: 6, type: 'rewrite', icon: '', title: 'Alcohol-Free Space', desc: 'Tea and polite talks create a social space without alcohol.',
              modalTitle: 'Exclusive Pubs â†’ Inclusive Safe Space', image: 'card1-blue1.jpg', modalImage: 'Pair 6.jpg', modalText: '<span class="label-bias">Bias: </span>Historically, drinking in public was considered a â€œmale activity.â€Bars and pubs were loud and unsafe for women. This made public social life unequal, as women could not participate freely or stay for long.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms created a different type of public space:Â bright, calm, and entirely alcohol-free, open to everyone regardless of gender. Both women and men could sit, talk, and spend time without the alcohol culture.' }
        ];

        // éš¾åº¦ï¼šç®€å• (Simple text from your prompt)
        const dataSimple = [
            // Pair 1 (Space - Light/Dark)
            { id: '1a', pairId: 1, type: 'ritual', icon: '', title: 'Light/Dark Spaces', desc: 'Menâ€™s rooms were darker; womenâ€™s rooms were brighter.',
              modalTitle: 'Divided by Gender â†’ Choice by Mood', image: 'card1-red1.jpg', modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">Bias: </span>In the past, men\'s spaces were often designed to be darker to create a serious, focused atmosphere suitable for business talks and contemplation. Women\'s spaces, on the other hand, were brighter and more relaxed, making it easier for socializing and personal grooming.<br><br><span class="label-fix">Fix: </span>Spaces no longer need to be divided by genderâ€”people can freely choose different rooms and lighting based on their needs.' },
            { id: '1b', pairId: 1, type: 'rewrite', icon: '', title: 'Choose by Mood', desc: 'Customers can choose a room based on their needs.',
              modalTitle: 'Divided by Gender â†’ Choice by Mood', image: 'card1-blue1.jpg', modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">Bias: </span>In the past, men\'s spaces were often designed to be darker to create a serious, focused atmosphere suitable for business talks and contemplation. Women\'s spaces, on the other hand, were brighter and more relaxed, making it easier for socializing and personal grooming.<br><br><span class="label-fix">Fix: </span>Spaces no longer need to be divided by genderâ€”people can freely choose different rooms and lighting based on their needs.' },
            
            // Pair 2 (Updated: Missing Names)
            { id: '2a', pairId: 2, type: 'ritual', icon: '', title: 'Missing Names', desc: 'Thereâ€™s space on the list, but it rarely carries their names.',
              modalTitle: 'Hidden Labor â†’ Proud Signatures', image: 'card1-red1.jpg', modalImage: 'Pair 2.jpg', modalText: '<span class="label-bias">Bias: </span>For a long time, women contributed to design, service, and creative work, but their names were rarely shown. Men signed the ideas. Womenâ€™s labor stayed invisible and undervalued.<br><br><span class="label-fix">Fix: </span>In places like the Willow Tea Rooms, women began to have their names written on menus, design work, and management roles. Their contributions were seen as professional Their handwriting finally appeared where it belonged.' },
            { id: '2b', pairId: 2, type: 'rewrite', icon: '', title: 'Her Signature', desc: 'The important signature now carries her handwriting.',
              modalTitle: 'Hidden Labor â†’ Proud Signatures', image: 'card1-blue1.jpg', modalImage: 'Pair 2.jpg', modalText: '<span class="label-bias">Bias: </span>For a long time, women contributed to design, service, and creative work, but their names were rarely shown. Men signed the ideas. Womenâ€™s labor stayed invisible and undervalued.<br><br><span class="label-fix">Fix: </span>In places like the Willow Tea Rooms, women began to have their names written on menus, design work, and management roles. Their contributions were seen as professional Their handwriting finally appeared where it belonged.' },
            
            // Pair 3 (Updated: Built for Men)
            { id: '3a', pairId: 3, type: 'ritual', icon: '', title: 'Built for Men', desc: 'High stools, dark wooden tables, rough decorations',
              modalTitle: 'Male-Centric Design â†’ Comfort for Her', image: 'card1-red1.jpg', modalImage: 'Pair 3.jpg', modalText: '<span class="label-bias">Bias: </span>Historical public spaces were designed around male habits: tall stools, heavy dark furniture, smoky air, low lighting. Women often felt out of place, uncomfortable, or unsafe.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms transformed the environment. Mackintosh used light-colored wood,  floral motifs, patterned glass, bright palettes, and soft lighting to create a space where women could sit comfortably, see and be seen, and participate equally in public life.' },
            { id: '3b', pairId: 3, type: 'rewrite', icon: '', title: 'Designed for Her', desc: 'Light-colored make the space welcoming for women.',
              modalTitle: 'Male-Centric Design â†’ Comfort for Her', image: 'card1-blue1.jpg', modalImage: 'Pair 3.jpg', modalText: '<span class="label-bias">Bias: </span>Historical public spaces were designed around male habits: tall stools, heavy dark furniture, smoky air, low lighting. Women often felt out of place, uncomfortable, or unsafe.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms transformed the environment. Mackintosh used light-colored wood,  floral motifs, patterned glass, bright palettes, and soft lighting to create a space where women could sit comfortably, see and be seen, and participate equally in public life.' },
            
            // Pair 4 (Gossip)
            { id: '4a', pairId: 4, type: 'ritual', icon: '', title: 'Gossip', desc: 'Womenâ€™s discussions were often considered as gossip.',
              modalTitle: 'Dismissed Gossip â†’ Civic Power', image: 'card1-red1.jpg', modalImage: 'Pair 4.jpg', modalText: '<span class="label-bias">Bias: </span>Before the 20th century, women were not allowed to discuss politics, and their conversations were usually limited to daily life, often dismissed as gossip.<br><br><span class="label-fix">Fix: </span>At the Willow Tea Rooms, women not only exchanged information but also shared opinions. The tea room became a public forum, witnessing the exercise of civic rights.' },
            { id: '4b', pairId: 4, type: 'rewrite', icon: '', title: 'Public Forum', desc: 'Every conversation is treated as equally meaningful.',
              modalTitle: 'Dismissed Gossip â†’ Civic Power', image: 'card1-blue1.jpg', modalImage: 'Pair 4.jpg', modalText: '<span class="label-bias">Bias: </span>Before the 20th century, women were not allowed to discuss politics, and their conversations were usually limited to daily life, often dismissed as gossip.<br><br><span class="label-fix">Fix: </span>At the Willow Tea Rooms, women not only exchanged information but also shared opinions. The tea room became a public forum, witnessing the exercise of civic rights.' },
            
            // Pair 5 (Service - Invisible Service)
            { id: '5a', pairId: 5, type: 'ritual', icon: '', title: 'Invisible Service', desc: 'Servers wore the same color as the walls.',
              modalTitle: 'Living Decoration â†’ Respected Professional', image: 'card1-red1.jpg', modalImage: 'Pair 5.jpg', modalText: '<span class="label-bias">Bias: </span>In the early days, female servers were not seen as professionals to be noticed. They were expected to stay quiet and not disturb customers. Their uniforms often matched the walls, making them blend in and hard to see.<br><br><span class="label-fix">Fix: </span>Today, servers are respected professionals and donâ€™t need to stay hidden. Their uniforms have different colors to show their roles, making them easier for customers to see and appreciate.' },
            { id: '5b', pairId: 5, type: 'rewrite', icon: '', title: 'Visible Roles', desc: 'Different uniform colors of servers show different roles.',
              modalTitle: 'Living Decoration â†’ Respected Professional', image: 'card1-blue1.jpg', modalImage: 'Pair 5.jpg', modalText: '<span class="label-bias">Bias: </span>In the early days, female servers were not seen as professionals to be noticed. They were expected to stay quiet and not disturb customers. Their uniforms often matched the walls, making them blend in and hard to see.<br><br><span class="label-fix">Fix: </span>Today, servers are respected professionals and donâ€™t need to stay hidden. Their uniforms have different colors to show their roles, making them easier for customers to see and appreciate.' },
            
            // Pair 6 (Updated: Forbidden Glass)
            { id: '6a', pairId: 6, type: 'ritual', icon: '', title: 'Forbidden Glass', desc: 'Men Chers freely, while women stay cautious.',
              modalTitle: 'Exclusive Pubs â†’ Inclusive Safe Space', image: 'card1-red1.jpg', modalImage: 'Pair 6.jpg', modalText: '<span class="label-bias">Bias: </span>Historically, drinking in public was considered a â€œmale activity.â€Bars and pubs were loud and unsafe for women. This made public social life unequal, as women could not participate freely or stay for long.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms created a different type of public space:Â bright, calm, and entirely alcohol-free, open to everyone regardless of gender. Both women and men could sit, talk, and spend time without the alcohol culture.' },
            { id: '6b', pairId: 6, type: 'rewrite', icon: '', title: 'Alcohol-Free Space', desc: 'Sitting down to chat without alcohol, quiet and dignified.',
              modalTitle: 'Exclusive Pubs â†’ Inclusive Safe Space', image: 'card1-blue1.jpg', modalImage: 'Pair 6.jpg', modalText: '<span class="label-bias">Bias: </span>Historically, drinking in public was considered a â€œmale activity.â€Bars and pubs were loud and unsafe for women. This made public social life unequal, as women could not participate freely or stay for long.<br><br><span class="label-fix">Fix: </span>Willow Tea Rooms created a different type of public space:Â bright, calm, and entirely alcohol-free, open to everyone regardless of gender. Both women and men could sit, talk, and spend time without the alcohol culture.' }
        ];

        // --- 3. æ¸¸æˆçŠ¶æ€ ---
        const grid = document.getElementById('gameGrid');
        const modalOverlay = document.getElementById('modalOverlay');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const confirmBtn = document.getElementById('confirm-btn');
        const explosionOverlay = document.getElementById('explosion-overlay');
        
        let activeCardsData = []; // å½“å‰ä½¿ç”¨çš„æ•°æ®é›†
        let selectedDifficulty = null;
        let cards = [];
        let score = 0;
        let lives = 3;
        const maxLives = 3;
        let selectedCards = []; 
        let lockBoard = false;

        // --- 4. å‰ç½®é¡µé¢é€»è¾‘ (Landing Page Logic) ---
        function selectDifficulty(level) {
            selectedDifficulty = level;
            
            // UI æ›´æ–°ï¼šé«˜äº®é€‰ä¸­æŒ‰é’®
            document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');

            // æ¿€æ´»å¼€å§‹æŒ‰é’®
            const startBtn = document.getElementById('landing-start-btn');
            startBtn.disabled = false;
            startBtn.classList.add('ready');
        }

        function startGame() {
            if (!selectedDifficulty) return;

            // 1. è®¾ç½®æ•°æ®
            if (selectedDifficulty === 'simple') {
                activeCardsData = [...dataSimple];
            } else {
                activeCardsData = [...dataNormal];
            }

            // 2. åˆ‡æ¢ç•Œé¢
            document.getElementById('landing-page').style.display = 'none';
            const gameContainer = document.getElementById('game-container');
            gameContainer.style.display = 'flex'; // æ˜¾ç¤ºæ¸¸æˆç•Œé¢

            // 3. åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        }

        // --- 5. æ¸¸æˆä¸»é€»è¾‘ ---
        function initGame() {
            // ä½¿ç”¨ activeCardsData è€Œä¸æ˜¯ä¹‹å‰çš„ cardsData
            cards = [...activeCardsData].sort(() => 0.5 - Math.random());
            grid.innerHTML = '';
            
            lives = maxLives;
            score = 0;
            scoreEl.textContent = score;
            updateLivesDisplay();
            resetSelection(); 
            lockBoard = false;

            cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.classList.add('card');
                cardEl.dataset.pairId = card.pairId;
                cardEl.dataset.type = card.type;
                // æ•°æ®ç»‘å®š
                cardEl.dataset.modalTitle = card.modalTitle;
                cardEl.dataset.modalText = card.modalText;
                if(card.modalImage) cardEl.dataset.modalImage = card.modalImage;

                const frontContent = `
                    <div class="front"></div>
                `;

                let backContent = '';
                // é€»è¾‘ä¿æŒä¸å˜ï¼Œä¾ç„¶æ£€æŸ¥ image å±æ€§
                if (card.image) {
                    backContent = `
                        <div class="back" style="padding: 0; border: none; overflow: hidden;">
                            <img src="${card.image}" alt="${card.title}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0;">
                            <div class="text-overlay">
                                <div class="card-icon">${card.icon}</div>
                                <div class="card-title">${card.title}</div>
                                <div class="card-desc">${card.desc}</div>
                            </div>
                        </div>
                    `;
                } else {
                    backContent = `
                        <div class="back">
                            <div class="icon">${card.icon}</div>
                            <div class="title">${card.title}</div>
                            <div class="desc">${card.desc}</div>
                        </div>
                    `;
                }

                cardEl.innerHTML = frontContent + backContent;
                cardEl.addEventListener('click', handleCardClick);
                grid.appendChild(cardEl);
            });
        }

        function updateLivesDisplay() {
            let hearts = '';
            for(let i=0; i<maxLives; i++) {
                hearts += (i < lives) ? 'â¤ï¸' : 'ğŸ’”';
            }
            livesEl.textContent = hearts;
        }

        function handleCardClick(e) {
            if (lockBoard) return;
            const card = e.currentTarget;

            if (card.classList.contains('matched')) {
                showModal(card.dataset.modalTitle, card.dataset.modalText, card.dataset.modalImage);
                return;
            }

            if (card.classList.contains('flip')) {
                card.classList.remove('flip');
                selectedCards = selectedCards.filter(c => c !== card);
                updateConfirmButton();
                return;
            }

            if (selectedCards.length < 2) {
                card.classList.add('flip');
                selectedCards.push(card);
                updateConfirmButton();
            } else {
                card.classList.add('denying');
                setTimeout(() => card.classList.remove('denying'), 300);
            }
        }

        function updateConfirmButton() {
            if (selectedCards.length === 2) {
                confirmBtn.classList.add('active');
                confirmBtn.textContent = "Confirm Match";
            } else {
                confirmBtn.classList.remove('active');
                confirmBtn.textContent = selectedCards.length === 1 ? "Flip one more" : "Flip two cards";
            }
        }

        function triggerConfirmMatch() {
            if (lockBoard || selectedCards.length !== 2) return;

            const card1 = selectedCards[0];
            const card2 = selectedCards[1];

            // --- æ£€æŸ¥é…å¯¹ ---
            if (card1.dataset.pairId === card2.dataset.pairId) {
                // === ğŸŸ¢ é…å¯¹æˆåŠŸ (ä¿®æ”¹è¿™éƒ¨åˆ†) ===
                
                // 1. æ”¹å˜å¡ç‰‡æ ·å¼
                card1.classList.add('matched');
                card2.classList.add('matched');
                
                // 2. æ›´æ–°åˆ†æ•° (å®æ—¶è®¡ç®—)
                const matchedCount = document.querySelectorAll('.card.matched').length;
                score = matchedCount / 2;
                scoreEl.textContent = score;

                // 3. ã€æ–°å¢ã€‘æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶é”å®šå±å¹•
                const successToast = document.getElementById('success-toast');
                successToast.classList.add('active'); // æ˜¾ç¤º "Perfect Match!"
                createConfetti();
                lockBoard = true; // æš‚æ—¶é”å®šï¼Œé˜²æ­¢åœ¨åº†ç¥æ—¶ä¹±ç‚¹

                // 4. ã€æ–°å¢ã€‘å»¶è¿Ÿ 1ç§’ åå†å¼¹å‡ºè§£é‡Šæ¡†
                setTimeout(() => {
                    successToast.classList.remove('active'); // éšè—æç¤º
                    
                    // æ˜¾ç¤ºçŸ¥è¯†ç‚¹å¼¹çª—
                    showModal(card1.dataset.modalTitle, card1.dataset.modalText, card1.dataset.modalImage);
                    
                    resetSelection();
                    lockBoard = false; // è§£é”

                    // æ£€æŸ¥æ˜¯å¦é€šå…³
                    if(score === 6) {
                        setTimeout(() => alert("ğŸ‰ Congratulations! All rituals have been remixed!"), 800);
                    }
                }, 1000); // å»¶è¿Ÿ 1000 æ¯«ç§’ (1ç§’)

            } else {
                lockBoard = true;
                lives--;
                updateLivesDisplay();
                
                // ã€å…³é”®ä¿®æ”¹ç‚¹ã€‘åªéœ‡åŠ¨å¡ç‰ŒåŒºåŸŸï¼Œä¸éœ‡åŠ¨ body æˆ– container
                const gridArea = document.getElementById('gameGrid');
                gridArea.classList.add('shake-screen');
                setTimeout(() => gridArea.classList.remove('shake-screen'), 500);

                confirmBtn.classList.remove('active');
                confirmBtn.style.backgroundColor = "#d32f2f";
                confirmBtn.textContent = "Wrong Match! Lives -1";

                setTimeout(() => {
                    confirmBtn.style.backgroundColor = ""; 
                    if (lives <= 0) {
                        triggerExplosion();
                    } else {
                        card1.classList.remove('flip');
                        card2.classList.remove('flip');
                        resetSelection();
                        lockBoard = false;
                    }
                }, 1000);
            }
        }

        function resetSelection() {
            selectedCards = [];
            updateConfirmButton();
        }

        function triggerExplosion() {
            explosionOverlay.classList.add('active');
            // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦éšè—çš„æ˜¯ #game-containerï¼Œå› ä¸º grid åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†
            document.getElementById('game-container').style.opacity = '0';
            confirmBtn.style.display = 'none';
        }

        function showModal(title, text, image) {
            const imgContainer = document.getElementById('modalImageContainer');
            const iconContainer = document.getElementById('modalIconContainer');
            const modalImg = document.getElementById('modalImg');

            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerHTML = text; 

            if (image) {
                imgContainer.style.display = 'block';
                iconContainer.style.display = 'none';
                modalImg.src = image; 
            } else {
                imgContainer.style.display = 'none';
                iconContainer.style.display = 'block';
            }
            modalOverlay.classList.add('active');
        }

        function closeModal() {
            modalOverlay.classList.remove('active');
        }
        
        const rulesOverlay = document.getElementById('rulesOverlay');
        function openRules() { rulesOverlay.classList.add('active'); }
        function closeRules() { rulesOverlay.classList.remove('active'); }

        function backToMenu() {
            // 1. éšè—æ¸¸æˆç•Œé¢ï¼Œæ˜¾ç¤ºå°é¢
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('landing-page').style.display = 'flex';
    
            // 2. é‡ç½®æ¸¸æˆçŠ¶æ€ (é˜²æ­¢åˆ‡å›æ¥æ—¶çŠ¶æ€é”™ä¹±)
            score = 0;
            lives = maxLives;
            selectedCards = [];
            lockBoard = false;
    
            // 3. é‡ç½®æŒ‰é’®çŠ¶æ€
            const confirmBtn = document.getElementById('confirm-btn');
            confirmBtn.classList.remove('active');
            confirmBtn.textContent = "Please flip 2 cards";
            confirmBtn.style.backgroundColor = ""; 
    
            // 4. æ¸…ç©ºç½‘æ ¼ (ä¸‹æ¬¡å¼€å§‹æ—¶ä¼šé‡æ–°ç”Ÿæˆ)
            document.getElementById('game-grid').innerHTML = '';
        }

        // --- æ–°å¢ï¼šç”Ÿæˆå½©å¸¦çš„å‡½æ•° ---
        function createConfetti() {
            const colors = ['#e74c3c', '#3498db', '#f1c40f', '#2ecc71', '#9b59b6']; // çº¢è“é»„ç»¿ç´«
            const confettiCount = 60; // å½©å¸¦æ•°é‡

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
        
                // éšæœºä½ç½®ã€é¢œè‰²å’Œå¤§å°
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 8 + 6 + 'px'; // å¤§å° 6-14px
                confetti.style.height = Math.random() * 5 + 5 + 'px';
        
                // éšæœºåŠ¨ç”»æ—¶é•¿ï¼ˆæ¨¡æ‹Ÿä¸åŒä¸‹è½é€Ÿåº¦ï¼‰
                const duration = Math.random() * 2 + 2; // 2åˆ°4ç§’
                confetti.style.animation = `confettiFall ${duration}s linear forwards`;
        
                // éšæœºå»¶è¿Ÿï¼Œè®©å®ƒä»¬é”™è½æœ‰è‡´
                confetti.style.animationDelay = Math.random() * 0.5 + 's';

                document.body.appendChild(confetti);

                // åŠ¨ç”»ç»“æŸåæ¸…ç†å…ƒç´ ï¼Œé˜²æ­¢é¡µé¢å¡é¡¿
                setTimeout(() => {
                    confetti.remove();
                }, duration * 1000);
            }
        }

        // æ³¨æ„ï¼šè¿™é‡Œä¸å†è‡ªåŠ¨è°ƒç”¨ initGame()ï¼Œè€Œæ˜¯ç­‰å¾… startGame() è¢«ç‚¹å‡»
    </script>
</body>
</html>
