<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ritual Remix - ä¹ ä¿—é‡æ„</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        :root {
            --red-color: #8B0000;
            --blue-color: #0056b3;
            --green-color: #2E7D32;
            --bg-color: #f4f4f4;
            --modal-blue: #0056b3;
            --modal-text: #4a5568;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 40px;
            overflow-x: hidden; /* é˜²æ­¢éœ‡åŠ¨æ—¶å‡ºç°æ»šåŠ¨æ¡ */
        }

        /* å±å¹•éœ‡åŠ¨åŠ¨ç”»ç±» */
        .shake-screen {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        h1 {
            margin-top: 20px;
            font-size: 1.5rem;
            color: #333;
            text-align: center;
        }

        p.instruction {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-bottom: 15px;
            padding: 0 20px;
            max-width: 600px;
            line-height: 1.5;
        }

        /* --- æ¸¸æˆç½‘æ ¼å¸ƒå±€ --- */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 600px;
            width: 95%;
            perspective: 1000px;
            margin-bottom: 40px;
            transition: opacity 0.5s; /* çˆ†ç‚¸æ—¶æ·¡å‡º */
        }

        @media (min-width: 600px) {
            .game-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
        }

        /* --- å¡ç‰‡æ ·å¼ --- */
        .card {
            background-color: transparent;
            height: 160px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card.flip {
            transform: rotateY(180deg);
        }

        .front, .back {
            width: 100%;
            height: 100%;
            position: absolute;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 8px;
            box-sizing: border-box;
            backface-visibility: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .front {
            background-color: #333;
            color: white;
            font-weight: bold;
            border: 2px solid white;
        }

        .card[data-type="ritual"] .front {
            background: repeating-linear-gradient(45deg, var(--red-color), var(--red-color) 10px, #600000 10px, #600000 20px);
        }

        .card[data-type="rewrite"] .front {
            background: repeating-linear-gradient(45deg, var(--blue-color), var(--blue-color) 10px, #003d80 10px, #003d80 20px);
        }

        .back {
            background-color: white;
            transform: rotateY(180deg);
            border: 2px solid #ddd;
            padding-bottom: 25px;
        }

        .card[data-type="ritual"] .back { border-top: 8px solid var(--red-color); color: var(--red-color); }
        .card[data-type="rewrite"] .back { border-top: 8px solid var(--blue-color); color: var(--blue-color); }

        .card.matched .back {
            border-color: var(--green-color);
            box-shadow: 0 0 10px rgba(46, 125, 50, 0.3);
        }

        .card.matched .back::after {
            content: "â„¹ï¸ ç‚¹å‡»å›é¡¾";
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            background-color: var(--green-color);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease-in-out;
        }

        .icon { font-size: 1.8rem; margin-bottom: 5px; }
        .title { font-weight: bold; margin-bottom: 5px; font-size: 0.95rem; }
        .desc { font-size: 0.8rem; color: #555; }

        /* --- å¼¹çª—æ ·å¼ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            z-index: 100; opacity: 0; pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal {
            background: white; 
            padding: 24px; 
            border-radius: 28px;
            width: 85%; 
            max-width: 360px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
        }

        .modal-image-container {
            width: 100%;
            height: auto;
            display: none; 
            margin-bottom: 10px;
        }
        
        .modal-image-container img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            border-radius: 20px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }

        .modal-icon-container {
            margin-top: 10px;
            margin-bottom: 20px;
            display: none; 
        }

        .modal-content-area {
            padding: 15px 0 0 0; 
            text-align: left;
            width: 100%;
        }

        .modal h2 { 
            color: var(--modal-blue);
            margin: 0 0 15px 0; 
            font-size: 1.3rem;
            text-align: center;
            font-weight: 900;
            letter-spacing: 0.5px;
        }

        .modal p { 
            color: var(--modal-text); 
            line-height: 1.6; 
            font-size: 0.9rem; 
            margin-bottom: 12px; 
            text-align: justify;
        }

        .label-bias, .label-fix { 
            color: var(--modal-blue); 
            font-weight: bold; 
            font-size: 0.95rem;
        }
        
        .close-btn {
            background: var(--modal-blue); 
            color: white;
            border: none; 
            width: 140px;
            padding: 10px 0; 
            border-radius: 50px;
            cursor: pointer; 
            font-size: 0.9rem; 
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0, 86, 179, 0.3);
            transition: transform 0.1s, box-shadow 0.2s;
            margin-top: 25px; 
        }
        .close-btn:hover { box-shadow: 0 8px 16px rgba(0, 86, 179, 0.4); transform: translateY(-1px); }
        .close-btn:active { transform: scale(0.98); }

        /* --- çŠ¶æ€æ è°ƒæ•´ --- */
        #status-bar {
            margin-bottom: 15px; font-weight: bold;
            background: white; padding: 8px 20px;
            border-radius: 20px; color: var(--blue-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            align-items: center;
        }

        #lives-container {
            color: #d32f2f;
        }

        /* --- çˆ†ç‚¸ç‰¹æ•ˆ (æ–°å¢) --- */
        #explosion-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(255,200,0,1) 0%, rgba(255,50,0,0.8) 50%, rgba(0,0,0,0.95) 100%);
            display: flex; 
            flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 200; 
            opacity: 0; 
            pointer-events: none;
            transition: opacity 0.2s;
            overflow: hidden;
        }

        #explosion-overlay.active {
            opacity: 1;
            pointer-events: all;
            animation: flash 0.5s ease-out;
        }

        .boom-text {
            font-size: 5rem;
            color: white;
            font-weight: 900;
            text-shadow: 0 0 20px black;
            transform: scale(0);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #explosion-overlay.active .boom-text {
            transform: scale(1);
            animation: shake 0.5s infinite;
        }

        .game-over-btn {
            margin-top: 50px;
            background: white;
            color: #d32f2f;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s 1s, transform 0.5s 1s; /* å»¶è¿Ÿæ˜¾ç¤º */
        }

        #explosion-overlay.active .game-over-btn {
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes flash {
            0% { background: white; }
            100% { background: radial-gradient(circle, rgba(255,69,0,1) 0%, rgba(0,0,0,1) 90%); }
        }

    </style>
</head>
<body>

    <h1>ğŸƒ ä¹ ä¿—é‡æ„ (Ritual Remix)</h1>
    <p class="instruction">
        ç¿»è½¬å¡ç‰‡ï¼Œå°† <b>å†å²æ—§è§„ (çº¢)</b> ä¸ <b>è§£å†³æ–¹æ¡ˆ (è“)</b> è¿›è¡Œé…å¯¹ã€‚<br>
        <span style="font-size: 0.8rem; color: var(--green-color);">âœ¨ æç¤ºï¼šåªæœ‰ 5 æ¬¡é”™è¯¯æœºä¼šï¼Œå°å¿ƒçˆ†ç‚¸ï¼</span>
    </p>
    
    <div id="status-bar">
        <div>å·²é…å¯¹: <span id="score">0</span> / 6</div>
        <div id="lives-container">ç”Ÿå‘½: <span id="lives">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span></div>
    </div>

    <div class="game-grid" id="gameGrid">
        </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-image-container" id="modalImageContainer">
                <img id="modalImg" src="" alt="Explanation">
            </div>

            <div class="modal-icon-container" id="modalIconContainer">
                <div class="icon" id="modalIcon" style="font-size: 3rem;">âœ¨</div>
            </div>

            <div class="modal-content-area">
                <h2 id="modalTitle">æ ‡é¢˜</h2>
                <div id="modalText">å†…å®¹...</div>
            </div>
            
            <button class="close-btn" onclick="closeModal()">ç»§ç»­æ¸¸æˆ</button>
        </div>
    </div>

    <div id="explosion-overlay">
        <div class="boom-text">BOOM!</div>
        <div style="color: white; font-size: 1.2rem; margin-top: 20px; font-weight: bold;">ä»»åŠ¡å¤±è´¥ï¼Œå¡ç‰Œå·²é”€æ¯</div>
        <button class="game-over-btn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        // --- 1. æ¸¸æˆæ•°æ® ---
        const cardsData = [
            // Pair 1: Space (ç©ºé—´)
            { id: '1a', pairId: 1, type: 'ritual', icon: 'ğŸšª', title: 'æ˜æš—ä¹‹åˆ†', desc: 'ç”·å£«å…¥æš—å®¤ï¼Œå¥³å£«è¿›æ˜å…ã€‚',
              modalTitle: 'ç©ºé—´åˆ»æ¿å°è±¡', 
              modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">åè§ï¼š</span>è¿™ç§è®¾è®¡å¼ºåŒ–äº†ç”·æ€§åº”è¯¥â€œä¸¥è‚ƒæ·±æ²‰â€ï¼Œè€Œå¥³æ€§åº”è¯¥â€œä½œä¸ºè£…é¥°â€çš„åˆ»æ¿å°è±¡ã€‚<br><br><span class="label-fix">ä¿®æ­£ï¼š</span>åº”æ ¹æ®æƒ…æ„Ÿéœ€æ±‚ï¼ˆå¦‚ç§å¯†æ€§æˆ–ç¤¾äº¤æ€§ï¼‰è€Œéæ€§åˆ«åˆ†ç±»æ¥è®¾è®¡ç©ºé—´ã€‚' 
            },
            { id: '1b', pairId: 1, type: 'rewrite', icon: 'ğŸŒ—', title: 'éšå¿ƒé€‰åº§', desc: 'æŒ‰ç§å¯†éœ€æ±‚è€Œéæ€§åˆ«è½åº§ã€‚',
              modalTitle: 'ç©ºé—´åˆ»æ¿å°è±¡', 
              modalImage: 'Pair 1.jpg',
              modalText: '<span class="label-bias">åè§ï¼š</span>è¿™ç§è®¾è®¡å¼ºåŒ–äº†ç”·æ€§åº”è¯¥â€œä¸¥è‚ƒæ·±æ²‰â€ï¼Œè€Œå¥³æ€§åº”è¯¥â€œä½œä¸ºè£…é¥°â€çš„åˆ»æ¿å°è±¡ã€‚<br><br><span class="label-fix">ä¿®æ­£ï¼š</span>åº”æ ¹æ®æƒ…æ„Ÿéœ€æ±‚ï¼ˆå¦‚ç§å¯†æ€§æˆ–ç¤¾äº¤æ€§ï¼‰è€Œéæ€§åˆ«åˆ†ç±»æ¥è®¾è®¡ç©ºé—´ã€‚' 
            },
            // Pair 2-6 ä¿æŒä¸å˜...
            { id: '2a', pairId: 2, type: 'ritual', icon: 'ğŸª‘', title: 'é«˜èƒŒæ¤…', desc: 'åƒç”»æ¡†ä¸€æ ·æ¡†ä½å¥³æ€§ã€‚',
              modalTitle: 'è¢«å®¡è§†çš„è§†è§’', modalText: '<b>åè§ï¼š</b> éº¦é‡‘æ‰˜ä»€çš„é«˜èƒŒæ¤…åƒç”»æ¡†ä¸€æ ·å°†å¥³æ€§â€œæ¡†â€åœ¨å…¶ä¸­ï¼Œä½¿å…¶æˆä¸ºè¢«è§‚èµçš„å¯¹è±¡ã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾è®¡åº”ä¼˜å…ˆè€ƒè™‘èº«ä½“çš„èˆ’é€‚ä¸è‡ªç”±ï¼Œè€Œéè§†è§‰æ„å›¾ã€‚' },
            { id: '2b', pairId: 2, type: 'rewrite', icon: 'ğŸ›‹ï¸', title: 'èˆ’é€‚è‡³ä¸Š', desc: 'äººä½“å·¥å­¦ä¼˜äºè¢«è§‚èµæ€§ã€‚',
              modalTitle: 'è¢«å®¡è§†çš„è§†è§’', modalText: '<b>åè§ï¼š</b> éº¦é‡‘æ‰˜ä»€çš„é«˜èƒŒæ¤…åƒç”»æ¡†ä¸€æ ·å°†å¥³æ€§â€œæ¡†â€åœ¨å…¶ä¸­ï¼Œä½¿å…¶æˆä¸ºè¢«è§‚èµçš„å¯¹è±¡ã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾è®¡åº”ä¼˜å…ˆè€ƒè™‘èº«ä½“çš„èˆ’é€‚ä¸è‡ªç”±ï¼Œè€Œéè§†è§‰æ„å›¾ã€‚' },
            { id: '3a', pairId: 3, type: 'ritual', icon: 'ğŸ™Š', title: 'ä»–ç‚¹å•', desc: 'å…¬å…±åœºåˆç”±ç”·å£«ä»£åŠ³ç‚¹å•ã€‚',
              modalTitle: 'è¢«å™¤å£°çš„è‡ªä¸»æƒ', modalText: '<b>åè§ï¼š</b> ä¼ ç»Ÿç¤¼ä»ªåœ¨äº¤æ˜“å’Œç‚¹å•ç¯èŠ‚å‰¥å¤ºäº†å¥³æ€§ç›´æ¥å¯¹è¯çš„æƒåˆ©ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ä½¿ç”¨å½©çƒï¼ˆçº¢=èŒ¶ï¼Œè“=å’–å•¡ï¼‰ä½œä¸ºå®ç‰©ä»£ç ï¼Œè®©æ¯ä¸ªäººæ— éœ€å¼€å£å³å¯å¹³ç­‰è¡¨è¾¾éœ€æ±‚ã€‚' },
            { id: '3b', pairId: 3, type: 'rewrite', icon: 'ğŸ”´ğŸ”µ', title: 'å½©çƒæš—å·', desc: 'å®ç‰©ç¼–ç å®ç°å¹³ç­‰å‘å£°ã€‚',
              modalTitle: 'è¢«å™¤å£°çš„è‡ªä¸»æƒ', modalText: '<b>åè§ï¼š</b> ä¼ ç»Ÿç¤¼ä»ªåœ¨äº¤æ˜“å’Œç‚¹å•ç¯èŠ‚å‰¥å¤ºäº†å¥³æ€§ç›´æ¥å¯¹è¯çš„æƒåˆ©ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ä½¿ç”¨å½©çƒï¼ˆçº¢=èŒ¶ï¼Œè“=å’–å•¡ï¼‰ä½œä¸ºå®ç‰©ä»£ç ï¼Œè®©æ¯ä¸ªäººæ— éœ€å¼€å£å³å¯å¹³ç­‰è¡¨è¾¾éœ€æ±‚ã€‚' },
            { id: '4a', pairId: 4, type: 'ritual', icon: 'ğŸ—£ï¸', title: 'é—²è¨€ç¢è¯­', desc: 'èŒ¶å®¤è°ˆè¯è¢«è§†ä¸ºçç¢é—²èŠã€‚',
              modalTitle: 'è¯é¢˜è´¬ä½', modalText: '<b>åè§ï¼š</b> å°†å¥³æ€§çš„ç¤¾äº¤ç½‘ç»œè´¬ä½ä¸ºâ€œå…«å¦â€ï¼Œè€Œç”·æ€§çš„è°ˆè¯åˆ™æ˜¯â€œç”Ÿæ„â€ã€‚<br><br><b>ä¿®æ­£ï¼š</b> å°†ç©ºé—´é‡å¡‘ä¸ºåˆ›æ„ä¼šè®®å®¤ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰å½¢å¼çš„å¯¹è¯éƒ½å…·æœ‰åŒç­‰ä»·å€¼ã€‚' },
            { id: '4b', pairId: 4, type: 'rewrite', icon: 'ğŸ¤', title: 'ç¤¾åŒºä¸­å¿ƒ', desc: 'æ‰€æœ‰å¯¹è¯çš†æœ‰ä»·å€¼ã€‚',
              modalTitle: 'è¯é¢˜è´¬ä½', modalText: '<b>åè§ï¼š</b> å°†å¥³æ€§çš„ç¤¾äº¤ç½‘ç»œè´¬ä½ä¸ºâ€œå…«å¦â€ï¼Œè€Œç”·æ€§çš„è°ˆè¯åˆ™æ˜¯â€œç”Ÿæ„â€ã€‚<br><br><b>ä¿®æ­£ï¼š</b> å°†ç©ºé—´é‡å¡‘ä¸ºåˆ›æ„ä¼šè®®å®¤ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰å½¢å¼çš„å¯¹è¯éƒ½å…·æœ‰åŒç­‰ä»·å€¼ã€‚' },
            { id: '5a', pairId: 5, type: 'ritual', icon: 'ğŸ‘—', title: 'æ´»ä½“è£…é¥°', desc: 'å¥³ä¾è€…ä¸å¢™å£èä¸ºä¸€ä½“ã€‚',
              modalTitle: 'ç¾å­¦åŠ³å½¹', modalText: '<b>åè§ï¼š</b> è¿™ç§è®¾è®¡å°†æœåŠ¡äººå‘˜è§†ä¸ºç¯å¢ƒä¸­çš„è£…é¥°æ‘†è®¾ï¼Œè€ŒéèŒä¸šåŠ³åŠ¨è€…ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ç™½è‰²ä¿¡å·çƒä»£è¡¨â€œéœ€è¦æœåŠ¡â€ã€‚è¿™ä½¿è§’è‰²ä»è¢«åŠ¨çš„ä¾ä»è½¬å˜ä¸ºä¸»åŠ¨å“åº”çš„ä¸“ä¸šäººå‘˜ã€‚' },
            { id: '5b', pairId: 5, type: 'rewrite', icon: 'âšª', title: 'ç™½è‰²ä¿¡å·çƒ', desc: 'æŒ‰éœ€æœåŠ¡ï¼Œè€Œéå±•ç¤ºã€‚',
              modalTitle: 'ç¾å­¦åŠ³å½¹', modalText: '<b>åè§ï¼š</b> è¿™ç§è®¾è®¡å°†æœåŠ¡äººå‘˜è§†ä¸ºç¯å¢ƒä¸­çš„è£…é¥°æ‘†è®¾ï¼Œè€ŒéèŒä¸šåŠ³åŠ¨è€…ã€‚<br><br><b>ä¿®æ­£ï¼š</b> ç™½è‰²ä¿¡å·çƒä»£è¡¨â€œéœ€è¦æœåŠ¡â€ã€‚è¿™ä½¿è§’è‰²ä»è¢«åŠ¨çš„ä¾ä»è½¬å˜ä¸ºä¸»åŠ¨å“åº”çš„ä¸“ä¸šäººå‘˜ã€‚' },
            { id: '6a', pairId: 6, type: 'ritual', icon: 'ğŸ§¾', title: 'è´¦å•', desc: 'è´¦å•è‡ªåŠ¨é€’ç»™ç”·å£«ã€‚',
              modalTitle: 'ç»æµä¾é™„', modalText: '<b>åè§ï¼š</b> é»˜è®¤é¢„è®¾ç”·æ€§ä¸ºå”¯ä¸€çš„â€œä¾›å…»è€…â€æˆ–ä¹°å•äººã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾ç½®ä¸­ç«‹æ”¯ä»˜åŒºæˆ–äºŒç»´ç ï¼Œä½¿ä»˜æ¬¾æˆä¸ºä¸€ç§ç§å¯†çš„ã€åŠŸèƒ½æ€§çš„è¡Œä¸ºï¼Œè€Œéä¸€ç§æ€§åˆ«è¡¨æ¼”ã€‚' },
            { id: '6b', pairId: 6, type: 'rewrite', icon: 'ğŸ“±', title: 'ä¸­ç«‹æ”¯ä»˜', desc: 'ä¸­å¤®åŒºåŸŸï¼Œç§å¯†æ”¯ä»˜ã€‚',
              modalTitle: 'ç»æµä¾é™„', modalText: '<b>åè§ï¼š</b> é»˜è®¤é¢„è®¾ç”·æ€§ä¸ºå”¯ä¸€çš„â€œä¾›å…»è€…â€æˆ–ä¹°å•äººã€‚<br><br><b>ä¿®æ­£ï¼š</b> è®¾ç½®ä¸­ç«‹æ”¯ä»˜åŒºæˆ–äºŒç»´ç ï¼Œä½¿ä»˜æ¬¾æˆä¸ºä¸€ç§ç§å¯†çš„ã€åŠŸèƒ½æ€§çš„è¡Œä¸ºï¼Œè€Œéä¸€ç§æ€§åˆ«è¡¨æ¼”ã€‚' }
        ];

        // --- 2. æ¸¸æˆé€»è¾‘ ---
        const grid = document.getElementById('gameGrid');
        const modalOverlay = document.getElementById('modalOverlay');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const explosionOverlay = document.getElementById('explosion-overlay');
        
        let cards = [];
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let score = 0;
        
        // æ–°å¢ï¼šç”Ÿå‘½å€¼å˜é‡
        let lives = 5;
        const maxLives = 5;

        function initGame() {
            cards = [...cardsData].sort(() => 0.5 - Math.random());
            grid.innerHTML = '';
            
            // é‡ç½®ç”Ÿå‘½å€¼
            lives = maxLives;
            updateLivesDisplay();

            cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.classList.add('card');
                cardEl.dataset.pairId = card.pairId;
                cardEl.dataset.type = card.type;
                
                cardEl.dataset.modalTitle = card.modalTitle;
                cardEl.dataset.modalText = card.modalText;
                if(card.modalImage) cardEl.dataset.modalImage = card.modalImage;

                const frontContent = `
                    <div class="front">
                        <span style="font-size:1.5rem;">?</span>
                        <span>${card.type === 'ritual' ? 'æ—§è§„' : 'æ–°è§£'}</span>
                    </div>
                `;

                let backContent = '';
                if (card.image) {
                    backContent = `
                        <div class="back" style="padding: 0; border: none; overflow: hidden;">
                            <img src="${card.image}" alt="${card.title}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                        </div>
                    `;
                } else {
                    backContent = `
                        <div class="back">
                            <div class="icon">${card.icon}</div>
                            <div class="title">${card.title}</div>
                            <div class="desc">${card.desc}</div>
                        </div>
                    `;
                }

                cardEl.innerHTML = frontContent + backContent;
                cardEl.addEventListener('click', handleCardClick);
                grid.appendChild(cardEl);
            });
        }

        function updateLivesDisplay() {
            let hearts = '';
            for(let i=0; i<maxLives; i++) {
                if(i < lives) hearts += 'â¤ï¸';
                else hearts += 'ğŸ’”'; // å¤±å»çš„ç”Ÿå‘½æ˜¾ç¤ºä¸ºç ´ç¢çš„å¿ƒ
            }
            livesEl.textContent = hearts;
        }

        function handleCardClick() {
            if (this.classList.contains('matched')) {
                showModal(this.dataset.modalTitle, this.dataset.modalText, this.dataset.modalImage);
                return;
            }

            if (lockBoard) return;
            if (this === firstCard) return;

            this.classList.add('flip');

            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = this;
                return;
            }

            secondCard = this;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.pairId === secondCard.dataset.pairId;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            lockBoard = true;
            score++;
            scoreEl.textContent = score;

            firstCard.classList.add('matched');
            secondCard.classList.add('matched');

            setTimeout(() => {
                showModal(firstCard.dataset.modalTitle, firstCard.dataset.modalText, firstCard.dataset.modalImage);
                resetBoard();
                if(score === 6) {
                    setTimeout(() => alert("ğŸ‰ æ­å–œï¼æ‰€æœ‰æ—§ä¿—å·²å®Œæˆé‡æ„ï¼"), 800);
                }
            }, 1000); 
        }

        function unflipCards() {
            lockBoard = true;
            
            // --- æƒ©ç½šé€»è¾‘ ---
            lives--;
            updateLivesDisplay();
            
            // å±å¹•éœ‡åŠ¨åé¦ˆ
            document.body.classList.add('shake-screen');
            setTimeout(() => document.body.classList.remove('shake-screen'), 500);

            if (lives <= 0) {
                // å¦‚æœç”Ÿå‘½è€—å°½ï¼Œè§¦å‘çˆ†ç‚¸
                setTimeout(() => {
                    triggerExplosion();
                }, 800);
            } else {
                // å¦‚æœè¿˜æœ‰ç”Ÿå‘½ï¼Œæ­£å¸¸ç¿»å›
                setTimeout(() => {
                    firstCard.classList.remove('flip');
                    secondCard.classList.remove('flip');
                    resetBoard();
                }, 1500); 
            }
        }

        function triggerExplosion() {
            // æ˜¾ç¤ºçˆ†ç‚¸å±‚
            explosionOverlay.classList.add('active');
            // éšè—æ¸¸æˆç½‘æ ¼
            grid.style.opacity = '0';
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        function showModal(title, text, image) {
            const imgContainer = document.getElementById('modalImageContainer');
            const iconContainer = document.getElementById('modalIconContainer');
            const modalImg = document.getElementById('modalImg');

            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerHTML = text; 

            if (image) {
                imgContainer.style.display = 'block';
                iconContainer.style.display = 'none';
                modalImg.src = image; 
            } else {
                imgContainer.style.display = 'none';
                iconContainer.style.display = 'block';
            }

            modalOverlay.classList.add('active');
        }

        function closeModal() {
            modalOverlay.classList.remove('active');
        }

        initGame();
    </script>
</body>
</html>
