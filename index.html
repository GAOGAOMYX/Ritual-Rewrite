<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çˆ±çš„é—¯å…³å°å†’é™©</title>
    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        h2 { color: #333; font-weight: 300; margin-bottom: 20px; text-align: center;}
        .stage-container { 
            display: none; /* é»˜è®¤éšè—æ‰€æœ‰å…³å¡ */
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s ease-in-out;
        }
        .active-stage { display: flex; } /* åªæ˜¾ç¤ºå½“å‰å…³å¡ */

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ç¬¬ä¸€å…³ï¼šå¯»æ‰¾çˆ±å¿ƒ æ ·å¼ --- */
        #stage1-area {
            width: 300px;
            height: 300px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        .hidden-heart {
            position: absolute;
            font-size: 24px;
            cursor: pointer;
            animation: floatAnim 3s ease-in-out infinite alternate;
            transition: transform 0.2s;
        }
        .hidden-heart:active { transform: scale(1.5); }
        @keyframes floatAnim { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        /* --- ç¬¬äºŒå…³ï¼šæ»‘åŠ¨è§£é” æ ·å¼ --- */
        #slider-container {
            width: 80%;
            height: 50px;
            background-color: #eee;
            border-radius: 25px;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 14px;
        }
        #slider-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            border-radius: 50%;
            position: absolute;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 10px rgba(255, 71, 87, 0.3);
            cursor: grab;
        }

        /* --- ç¬¬ä¸‰å…³ï¼šç‚¹å‡»å……èƒ½ï¼ˆä¿ç•™ä½ åŸæ¥çš„æ ·å¼ï¼‰ --- */
        .progress-wrapper {
            width: 80%; height: 10px; background-color: #eee; border-radius: 5px; overflow: hidden; margin-bottom: 50px;
        }
        .progress-bar {
            width: 0%; height: 100%; background-color: #ff4757; transition: width 0.1s linear;
        }
        .heart-btn {
            font-size: 80px; cursor: pointer; user-select: none; transition: transform 0.1s;
            filter: drop-shadow(0 5px 15px rgba(255, 71, 87, 0.4)); animation: pulse 1.5s infinite;
        }
        .heart-btn:active { transform: scale(0.9); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .particle {
            position: absolute; font-size: 20px; color: #ff4757; pointer-events: none; animation: floatUp 0.8s ease-out forwards;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.5); opacity: 0; } }

        /* --- æœ€åçš„å¼¹çª—æ ·å¼ï¼ˆä¿ç•™ä½ åŸæ¥çš„å†…å®¹ï¼‰ --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255,255,255,0.98); z-index: 100; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; animation: fadeInModal 0.5s;
        }
        @keyframes fadeInModal { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .modal-content { padding: 30px; }
        .modal h1 { color: #ff4757; font-size: 32px; margin-bottom: 10px; }
        .modal p { color: #555; font-size: 18px; line-height: 1.6; margin: 10px 0; }
        .big-text { font-size: 24px; font-weight: bold; color: #2f3542; margin-top: 20px; display: block; }
    </style>
</head>
<body>

    <div id="stage1" class="stage-container active-stage">
        <h2>ç¬¬ä¸€å…³ï¼šæ”¶é›†æ•£è½çš„çˆ±æ„ (0/5)</h2>
        <p style="color:#999; font-size: 14px;">ç‚¹å‡»æ–¹æ¡†é‡Œå‡ºç°çš„å°çˆ±å¿ƒ</p>
        <div id="stage1-area"></div>
    </div>


    <div id="stage2" class="stage-container">
        <h2>ç¬¬äºŒå…³ï¼šè·¨è¶Šè·ç¦»èµ°å‘ä½ </h2>
        <p style="color:#999; font-size: 14px;">æ‹–åŠ¨æ»‘å—åˆ°åº•éƒ¨</p>
        <br>
        <div id="slider-container">
            å‘å³æ»‘åŠ¨ â†’
            <div id="slider-btn">ğŸ¿ï¸</div>
        </div>
    </div>


    <div id="stage3" class="stage-container">
        <h2>æœ€ç»ˆå…³ï¼šæŠŠå¿ƒå¡«æ»¡ â¤ï¸</h2>
        <div class="progress-wrapper">
            <div class="progress-bar" id="bar"></div>
        </div>
        <div class="heart-btn" id="btn" onclick="handleClick(event)">â¤ï¸</div>
    </div>


    <div class="modal" id="modal">
        <div class="modal-content">
            <h1>è€å©†æˆ‘çˆ±ä½ ï¼</h1>
            <p>ä½ æ°¸è¿œæ˜¯æˆ‘çš„é¦™é¦™è½¯è½¯çš„å°è›‹ç³•</p>
            <p>æˆ‘æ°¸è¿œæ˜¯ä½ çš„å°å¥¶ç³•</p>
            
            <span class="big-text">æˆ‘çˆ±ä½ ã€‚<br>æ°¸è¿œçˆ±ä½ ã€‚</span>
            
            <div style="margin-top:30px; font-size: 40px;">ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨</div>
        </div>
    </div>


    <script>
        // --- å…¨å±€æ§åˆ¶ ---
        let currentStage = 1;
        function nextStage() {
            document.getElementById('stage' + currentStage).classList.remove('active-stage');
            currentStage++;
            if (document.getElementById('stage' + currentStage)) {
                document.getElementById('stage' + currentStage).classList.add('active-stage');
                if(currentStage === 1) initStage1();
                if(currentStage === 2) initStage2();
            } else {
                // æ‰€æœ‰å…³å¡ç»“æŸï¼Œæ˜¾ç¤ºå¼¹çª—
                showFinalModal();
            }
        }

        // --- ç¬¬ä¸€å…³é€»è¾‘ ---
        let heartsFound = 0;
        const totalHeartsToFind = 5;
        const stage1Title = document.querySelector('#stage1 h2');
        
        function initStage1() {
            const area = document.getElementById('stage1-area');
            for (let i = 0; i < totalHeartsToFind; i++) {
                createHiddenHeart(area);
            }
        }

        function createHiddenHeart(container) {
            const heart = document.createElement('div');
            heart.innerText = ['ğŸ’–', 'ğŸ’•', 'ğŸ’—'][Math.floor(Math.random() * 3)];
            heart.className = 'hidden-heart';
            // éšæœºä½ç½®ï¼Œå‡å»çˆ±å¿ƒæœ¬èº«çš„å¤§å°é˜²æ­¢æº¢å‡º
            heart.style.left = Math.random() * (container.offsetWidth - 30) + 'px';
            heart.style.top = Math.random() * (container.offsetHeight - 30) + 'px';
            heart.onclick = function() {
                this.remove();
                heartsFound++;
                stage1Title.innerText = `ç¬¬ä¸€å…³ï¼šæ”¶é›†æ•£è½çš„çˆ±æ„ (${heartsFound}/${totalHeartsToFind})`;
                if (heartsFound >= totalHeartsToFind) {
                    setTimeout(nextStage, 500);
                }
            };
            container.appendChild(heart);
        }
        initStage1(); // å¼€å§‹å°±åŠ è½½ç¬¬ä¸€å…³

        // --- ç¬¬äºŒå…³é€»è¾‘ (æ»‘åŠ¨) ---
        function initStage2() {
            const sliderBtn = document.getElementById('slider-btn');
            const sliderContainer = document.getElementById('slider-container');
            let isDragging = false;
            let startX, initialLeft;

            // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            sliderBtn.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', doDrag);
            document.addEventListener('touchend', endDrag);
            // é¼ æ ‡äº‹ä»¶æ”¯æŒ (æ–¹ä¾¿ç”µè„‘æµ‹è¯•)
            sliderBtn.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', doDrag);
            document.addEventListener('mouseup', endDrag);

            function startDrag(e) {
                isDragging = true;
                startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                initialLeft = sliderBtn.offsetLeft;
                sliderBtn.style.transition = 'none';
            }

            function doDrag(e) {
                if (!isDragging) return;
                const currentX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const deltaX = currentX - startX;
                let newLeft = initialLeft + deltaX;
                const maxLeft = sliderContainer.offsetWidth - sliderBtn.offsetWidth;

                // é™åˆ¶æ»‘åŠ¨èŒƒå›´
                if (newLeft < 0) newLeft = 0;
                if (newLeft > maxLeft) newLeft = maxLeft;

                sliderBtn.style.left = newLeft + 'px';
                
                // åˆ¤æ–­æ˜¯å¦æ»‘åˆ°ç»ˆç‚¹ (è™½ç„¶endDragä¹Ÿä¼šåˆ¤æ–­ï¼Œè¿™é‡Œä¸ºäº†è§†è§‰åé¦ˆ)
                if (newLeft >= maxLeft - 5) {
                     sliderBtn.innerText = 'ğŸ’–';
                }
            }

            function endDrag(e) {
                if (!isDragging) return;
                isDragging = false;
                sliderBtn.style.transition = 'left 0.3s';
                const maxLeft = sliderContainer.offsetWidth - sliderBtn.offsetWidth;

                // å¦‚æœæ»‘åŠ¨è¶…è¿‡ 90%ï¼Œç®—æˆåŠŸ
                if (sliderBtn.offsetLeft > maxLeft * 0.9) {
                    sliderBtn.style.left = maxLeft + 'px';
                    sliderBtn.innerText = 'ğŸ‰';
                    setTimeout(nextStage, 800);
                } else {
                    // å¦åˆ™å¼¹å›
                    sliderBtn.style.left = '0px';
                    sliderBtn.innerText = 'ğŸ¿ï¸';
                }
            }
        }


        // --- ç¬¬ä¸‰å…³é€»è¾‘ (ä½ åŸæ¥çš„ä»£ç ) ---
        let clickCount = 0;
        const totalClicks = 20; 
        const bar = document.getElementById('bar');
        const btn = document.getElementById('btn');

        function handleClick(e) {
            if (clickCount >= totalClicks) return;
            clickCount++;
            
            const percent = (clickCount / totalClicks) * 100;
            bar.style.width = percent + '%';
            createParticle(e.clientX, e.clientY);
            if (navigator.vibrate) navigator.vibrate(50);

            if (clickCount >= totalClicks) {
                setTimeout(nextStage, 400); // è°ƒç”¨é€šç”¨çš„ä¸‹ä¸€å…³å‡½æ•°
            }
        }

        function createParticle(x, y) {
            const p = document.createElement('div');
            p.innerText = 'â¤';
            p.className = 'particle';
            const randomX = (Math.random() - 0.5) * 40;
            p.style.left = (x + randomX) + 'px';
            p.style.top = (y - 50) + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);
        }

        // --- æ˜¾ç¤ºæœ€ç»ˆå¼¹çª— ---
        function showFinalModal() {
            document.getElementById('modal').style.display = 'flex';
            if (navigator.vibrate) navigator.vibrate([200, 100, 200]); // æˆåŠŸéœ‡åŠ¨
        }
    </script>
</body>
</html>
